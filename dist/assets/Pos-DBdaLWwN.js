import{j as e}from"./vendor-pdf-renderer-Bq4DoPCL.js";import{r as n}from"./vendor-react-NkhADs9z.js";import{u as ee,c as te,b as se,a as ae,e as re}from"./index-BurnjtrH.js";import{U as ie,a as le}from"./DocumentConverter-Cv4_NsDK.js";import{o as ne,n as V,S as ce,s as de,v as oe,u as me,F as B,w as xe,B as he,x as ue,y as ge}from"./vendor-ui-DgdEuPZ6.js";import{f as pe}from"./vendor-utils-BK9ZHHVQ.js";import"./vendor-firebase-CWMDWzYz.js";import"./vendor-pdf-utils-BfYXEYrK.js";const b=[{id:"cash",name:"Cash",icon:he},{id:"card",name:"Credit Card",icon:ue},{id:"transfer",name:"Bank Transfer",icon:B},{id:"digital",name:"Digital Payment",icon:ge}];function $e(){const s=ee(t=>t.isDarkMode),{products:U,categories:_,searchQuery:x,selectedCategory:N,setSearchQuery:z,setSelectedCategory:Y}=te(),{clients:v}=se(),{tickets:q}=ae(),{createOrder:H}=re(),[d,h]=n.useState([]),[c,u]=n.useState(null),[w,C]=n.useState(null),[o,g]=n.useState(""),[p,S]=n.useState(""),[y,L]=n.useState(b[0].id),[ye,G]=n.useState(""),[k,M]=n.useState(""),[$,F]=n.useState(!1),[T,I]=n.useState("thermal"),[J,A]=n.useState(!1),[P,K]=n.useState(null),R=U.filter(t=>{const a=x?t.name.toLowerCase().includes(x.toLowerCase())||t.description.toLowerCase().includes(x.toLowerCase()):!0,l=N==="all"||t.category===N;return a&&l}),D=v.filter(t=>t.name.toLowerCase().includes(o.toLowerCase())||t.email.toLowerCase().includes(o.toLowerCase())||t.phone.toLowerCase().includes(o.toLowerCase())),O=q.filter(t=>{const a=p?t.ticketNumber.toLowerCase().includes(p.toLowerCase()):!0,l=c?t.clientId===c:!0;return a&&l}),m=d.reduce((t,a)=>t+a.product.price*a.quantity,0),f=m*.2,j=m+f,W=t=>{h(a=>a.find(i=>i.product.id===t.id)?a.map(i=>i.product.id===t.id?{...i,quantity:i.quantity+1}:i):[...a,{product:t,quantity:1}])},E=(t,a)=>{a<=0?h(l=>l.filter(i=>i.product.id!==t)):h(l=>l.map(i=>i.product.id===t?{...i,quantity:a}:i))},Q=()=>{h([]),u(null),C(null),g(""),S(""),L(b[0].id),M(""),F(!1),I("thermal")},X=()=>{const t="INV",a=pe(new Date,"yyMMdd"),l=Math.floor(1e3+Math.random()*9e3);return`${t}-${a}-${l}`},Z=async()=>{var i;if(d.length===0)return;const t=X();G(t);const a=c?v.find(r=>r.id===c):void 0,l={invoiceNumber:t,date:new Date().toISOString(),customer:a?{name:a.name,email:a.email,address:a.address,phone:a.phone,taxId:""}:void 0,items:d.map(r=>({id:r.product.id,name:r.product.name,sku:r.product.sku,quantity:r.quantity,price:r.product.price})),subtotal:m,tax:f,total:j,paymentMethod:((i=b.find(r=>r.id===y))==null?void 0:i.name)||y,paymentStatus:"Paid",note:k||void 0};K(l),A(!0),c&&(d.map(r=>({productId:r.product.id,quantity:r.quantity})),await H(c,j)),console.log("Sale created:",{invoiceId:t,items:d,client:c?v.find(r=>r.id===c):null,ticket:w?q.find(r=>r.id===w):null,subtotal:m,vat:f,total:j,paymentMethod:y,date:new Date().toISOString(),note:k})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:`text-2xl font-semibold ${s?"text-white":"text-gray-900"}`,children:"Point of Sale"})}),J&&P&&e.jsx(ie,{data:le(P),onClose:()=>{A(!1),Q()},initialFormat:T}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:`rounded-lg ${s?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-4 bg-white dark:bg-gray-700 p-4 rounded-lg shadow-inner",children:[e.jsx(ne,{className:"h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",value:x,onChange:t=>z(t.target.value),className:"flex-1 bg-transparent border-0 focus:ring-0 text-gray-900 dark:text-white placeholder-gray-400"})]}),e.jsxs("select",{value:N,onChange:t=>Y(t.target.value),className:"rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"All Categories"}),_.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:R.map(t=>e.jsxs("div",{className:`border rounded-lg overflow-hidden ${s?"border-gray-700":"border-gray-200"}`,children:[e.jsx("div",{className:"h-32 bg-gray-100 flex items-center justify-center",children:e.jsx("img",{src:t.imageUrl,alt:t.name,className:"h-full object-contain"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:`font-medium ${s?"text-white":"text-gray-900"}`,children:t.name}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`font-bold ${s?"text-white":"text-gray-900"}`,children:["$",t.price.toFixed(2)]}),e.jsx("button",{onClick:()=>W(t),className:"bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700",disabled:t.stock<=0,children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Stock: ",t.stock]})]})]},t.id))}),R.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:`text-lg ${s?"text-gray-400":"text-gray-500"}`,children:"No products found. Try a different search or category."})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`rounded-lg ${s?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:[e.jsx(ce,{className:"h-5 w-5 inline mr-2"}),"Cart"]}),e.jsx("button",{onClick:Q,className:"text-gray-400 hover:text-gray-500",disabled:d.length===0,children:e.jsx(de,{className:"h-5 w-5"})})]}),d.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:`text-lg ${s?"text-gray-400":"text-gray-500"}`,children:"Your cart is empty"})}):e.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto mb-4",children:d.map(t=>e.jsxs("div",{className:"flex items-center justify-between border-b pb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-medium ${s?"text-white":"text-gray-900"}`,children:t.product.name}),e.jsxs("p",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:["$",t.product.price.toFixed(2)," x ",t.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>E(t.product.id,t.quantity-1),className:"p-1 rounded-full hover:bg-gray-100",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx("span",{className:s?"text-white":"text-gray-900",children:t.quantity}),e.jsx("button",{onClick:()=>E(t.product.id,t.quantity+1),className:"p-1 rounded-full hover:bg-gray-100",disabled:t.quantity>=t.product.stock,children:e.jsx(V,{className:"h-4 w-4"})})]})]},t.product.id))}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:s?"text-gray-300":"text-gray-600",children:"Subtotal"}),e.jsxs("span",{className:s?"text-white":"text-gray-900",children:["$",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:s?"text-gray-300":"text-gray-600",children:"VAT (20%)"}),e.jsxs("span",{className:s?"text-white":"text-gray-900",children:["$",f.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{className:s?"text-white":"text-gray-900",children:"Total"}),e.jsxs("span",{className:s?"text-white":"text-gray-900",children:["$",j.toFixed(2)]})]})]})]}),e.jsxs("div",{className:`rounded-lg ${s?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsx("h2",{className:`text-lg font-semibold mb-4 ${s?"text-white":"text-gray-900"}`,children:"Checkout"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"quickSale",checked:$,onChange:t=>{F(t.target.checked),t.target.checked&&(u(null),g(""))},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"quickSale",className:`ml-2 block text-sm ${s?"text-gray-300":"text-gray-700"}`,children:"Quick Sale (No Client Info)"})]}),!$&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-1`,children:"Client"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:o,onChange:t=>{g(t.target.value),u(null)},placeholder:"Search for a client...",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),o&&!c&&D.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg max-h-60 overflow-y-auto",children:D.map(t=>e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{u(t.id),g(t.name)},children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.phone})]},t.id))})]})]}),c&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-1`,children:"Link to Repair Ticket (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:p,onChange:t=>{S(t.target.value),C(null)},placeholder:"Search for a ticket...",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),p&&!w&&O.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg max-h-60 overflow-y-auto",children:O.map(t=>e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{C(t.id),S(t.ticketNumber)},children:[e.jsxs("div",{className:"font-medium",children:["#",t.ticketNumber]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.deviceType," - ",t.brand]})]},t.id))})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${s?"text-gray-300":"text-gray-700"}`,children:"Receipt Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>I("thermal"),className:`flex flex-col items-center justify-center gap-2 p-3 rounded-md ${T==="thermal"?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(me,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:"Thermal Receipt"})]}),e.jsxs("button",{type:"button",onClick:()=>I("a4"),className:`flex flex-col items-center justify-center gap-2 p-3 rounded-md ${T==="a4"?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(B,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:"A4 Invoice"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-1`,children:"Payment Method"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:b.map(t=>e.jsxs("button",{type:"button",onClick:()=>L(t.id),className:`flex items-center justify-center gap-2 p-3 rounded-md ${y===t.id?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(t.icon,{className:"h-5 w-5"}),t.name]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-1`,children:"Note (Optional)"}),e.jsx("textarea",{value:k,onChange:t=>M(t.target.value),rows:2,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Add a note to this sale..."})]}),e.jsxs("button",{onClick:Z,disabled:d.length===0||!$&&!c,className:"w-full bg-indigo-600 text-white px-4 py-3 rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Complete Sale"]})]})]})]})]})]})}export{$e as default};
