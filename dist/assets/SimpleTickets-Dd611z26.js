const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bn9zpSYO.js","assets/vendor-pdf-renderer-gdX08-al.js","assets/vendor-react-Bpbu6kUi.js","assets/vendor-firebase-BDRyz5lN.js","assets/vendor-utils-CAoL40rE.js","assets/vendor-ui-CauP80sp.js","assets/vendor-pdf-utils-CBrSDip1.js","assets/index-Bk6sGNSy.css"])))=>i.map(i=>d[i]);
import{u as et,b as tt,g as Tt,a as m,d as Dt,f as Ke,R as b,U as Se,h as Et,i as Pt,j as At,_ as Qe}from"./index-Bn9zpSYO.js";import{j as e}from"./vendor-pdf-renderer-gdX08-al.js";import{r}from"./vendor-react-Bpbu6kUi.js";import{P as $t}from"./vendor-firebase-BDRyz5lN.js";import{X as Mt,v as Lt,w as _t,J as Ft,F as X,n as zt,p as pe,K as Xe,h as Rt,N as Ut,O as Bt,Q as qt,V as Ot,T as Ye}from"./vendor-ui-CauP80sp.js";import{f as Ze}from"./vendor-utils-CAoL40rE.js";import"./vendor-pdf-utils-CBrSDip1.js";function Vt({onSubmit:n,onCancel:w}){const u=et(i=>i.isDarkMode),{addClient:B,loading:v}=tt(),[p,l]=r.useState({name:"",email:"",phone:"",address:""}),[D,x]=r.useState("");r.useEffect(()=>{x(Tt())},[]);const N=async i=>{i.preventDefault();const q={...p,customerCode:D},z=await B(q);z?n(z):console.error("Failed to create client")};return e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${u?"text-gray-300":"text-gray-700"}`,children:"Name"}),e.jsx("input",{type:"text",value:p.name,onChange:i=>l({...p,name:i.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${u?"text-gray-300":"text-gray-700"}`,children:"Email (Optional)"}),e.jsx("input",{type:"email",value:p.email,onChange:i=>l({...p,email:i.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${u?"text-gray-300":"text-gray-700"}`,children:"Phone"}),e.jsx("input",{type:"tel",value:p.phone,onChange:i=>l({...p,phone:i.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${u?"text-gray-300":"text-gray-700"}`,children:"Address (Optional)"}),e.jsx("textarea",{value:p.address,onChange:i=>l({...p,address:i.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsx("div",{className:`p-4 rounded-lg ${u?"bg-indigo-900 border border-indigo-700":"bg-indigo-50 border border-indigo-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-full ${u?"bg-indigo-800":"bg-indigo-100"}`,children:e.jsx("svg",{className:`h-5 w-5 ${u?"text-indigo-400":"text-indigo-600"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:`text-sm font-medium ${u?"text-indigo-200":"text-indigo-800"}`,children:"Code d'accÃ¨s client"}),e.jsx("p",{className:`text-lg font-mono font-bold ${u?"text-indigo-100":"text-indigo-900"}`,children:D}),e.jsx("p",{className:`text-xs mt-1 ${u?"text-indigo-300":"text-indigo-600"}`,children:"Donnez ce code au client pour qu'il puisse accÃ©der Ã  ses rÃ©parations"})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:w,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:v,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",disabled:v,children:v?"Creating...":"Create Client"})]})]})}const Ht=[{id:"cash",name:"EspÃ¨ces",icon:Lt,description:"Paiement en espÃ¨ces"},{id:"card",name:"Carte bancaire",icon:_t,description:"Carte de crÃ©dit/dÃ©bit"},{id:"transfer",name:"Virement",icon:Ft,description:"Virement bancaire"},{id:"check",name:"ChÃ¨que",icon:X,description:"Paiement par chÃ¨que"}];function Gt({isOpen:n,onClose:w,onConfirm:u,ticketNumber:B,clientName:v,totalAmount:p}){const[l,D]=r.useState(""),x=()=>{l&&(u(l),D(""),w())},N=()=>{D(""),w()};return n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"MÃ©thode de paiement"}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Mt,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Ticket:"}),e.jsxs("span",{className:"font-medium",children:["#",B]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Client:"}),e.jsx("span",{className:"font-medium",children:v})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Montant total:"}),e.jsxs("span",{className:"font-medium text-lg",children:["â‚¬",p.toFixed(2)]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"SÃ©lectionnez la mÃ©thode de paiement utilisÃ©e:"}),Ht.map(i=>{const q=i.icon;return e.jsx("button",{onClick:()=>D(i.id),className:`w-full p-4 border rounded-lg text-left transition-all ${l===i.id?"border-indigo-500 bg-indigo-50 ring-2 ring-indigo-200":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:`h-5 w-5 ${l===i.id?"text-indigo-600":"text-gray-400"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${l===i.id?"text-indigo-900":"text-gray-900"}`,children:i.name}),e.jsx("div",{className:`text-sm ${l===i.id?"text-indigo-600":"text-gray-500"}`,children:i.description})]}),l===i.id&&e.jsx("div",{className:"text-indigo-600",children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-indigo-600 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})})})]})},i.id)})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Annuler"}),e.jsx("button",{onClick:x,disabled:!l,className:"px-4 py-2 bg-indigo-600 text-white rounded-md text-sm font-medium hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"GÃ©nÃ©rer la facture"})]})]})}):null}function ts(){var We;const n=et(t=>t.isDarkMode),{tickets:w,updateTicket:u,deleteTicket:B,loading:v,error:p,filterStatus:l,setFilterStatus:D}=m(),{clients:x}=tt(),{user:N,userRole:i}=Dt(),{createInvoiceFromTicket:q,invoices:z,fetchInvoices:Ce}=Ke(),y=r.useRef(!sessionStorage.getItem("ticketSessionActive"));y.current&&(sessionStorage.clear(),sessionStorage.setItem("ticketSessionActive","true"));const[Ie,M]=r.useState(()=>{try{return JSON.parse(sessionStorage.getItem("ticketFormStarted")||"false")}catch{return!1}}),[Jt,Te]=r.useState(!1),[g,ye]=r.useState(null),[R,O]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketClientSearch")||""}catch{return""}return""}),[L,_]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketSelectedClientId")||""}catch{return""}return""}),[st,fe]=r.useState(!1),[at,De]=r.useState(!1),[rt,Ee]=r.useState(!1),[Pe,Ae]=r.useState(!1),[I,V]=r.useState(null),[$e,Me]=r.useState(null),[Le,_e]=r.useState(""),[be,je]=r.useState(!1),[Ne,nt]=r.useState(""),[Fe,it]=r.useState([]),[ot,Y]=r.useState(!1),[dt,Z]=r.useState(!1),[ct,ee]=r.useState(!1),[lt,te]=r.useState(!1),[mt,we]=r.useState(!1),[k,H]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketDeviceType")||""}catch{return""}return""}),[h,G]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketBrand")||""}catch{return""}return""}),[T,E]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketModel")||""}catch{return""}return""}),[f,P]=r.useState(()=>{if(!y.current)try{const t=sessionStorage.getItem("ticketTasksWithPrice");return t?JSON.parse(t):[]}catch{return[]}return[]}),[se,ae]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketIssue")||""}catch{return""}return""}),[re,ne]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketPasscode")||""}catch{return""}return""}),[ie,ve]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketImeiSerial")||""}catch{return""}return""}),[oe,de]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketStatus")||"pending"}catch{return"pending"}return"pending"}),[ce,le]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketTechnicianId")||""}catch{return""}return""}),[J,W]=r.useState(()=>{if(!y.current)try{return sessionStorage.getItem("ticketPaymentStatus")||"not_paid"}catch{return"not_paid"}return"not_paid"}),[me,K]=r.useState(()=>{if(!y.current)try{return parseFloat(sessionStorage.getItem("ticketAmountPaid")||"0")}catch{return 0}return 0}),[F,ke]=r.useState(""),[ze,Re]=r.useState(0),[Ue,ut]=r.useState("desc"),[ue,xt]=r.useState("all"),[Be,gt]=r.useState("desc"),[A,xe]=r.useState("all");r.useEffect(()=>{A==="invoices"&&Ce()},[A,Ce]),r.useEffect(()=>{(async()=>{try{if(i===b.SUPER_ADMIN){const s=await At();it(s||[])}}catch(s){console.error("Error fetching technicians:",s)}})()},[i]),r.useEffect(()=>{if(g){const t=w.find(s=>s.id===g);t&&(H(t.deviceType||""),G(t.brand||""),E(t.model||""),ae(t.issue||""),ne(t.passcode||""),ve(t.imeiSerial||""),K(t.amountPaid||0),P(t.taskPrices||t.tasks.map(s=>({name:s,price:t.cost/(t.tasks.length||1)}))),de(t.status||"pending"),le(t.technicianId||""),W(t.paymentStatus||"not_paid"))}},[g]),r.useEffect(()=>{try{sessionStorage.setItem("ticketFormStarted",JSON.stringify(Ie)),sessionStorage.setItem("ticketClientSearch",R),sessionStorage.setItem("ticketSelectedClientId",L),sessionStorage.setItem("ticketDeviceType",k),sessionStorage.setItem("ticketBrand",h),sessionStorage.setItem("ticketModel",T),sessionStorage.setItem("ticketTasksWithPrice",JSON.stringify(f)),sessionStorage.setItem("ticketIssue",se),sessionStorage.setItem("ticketPasscode",re),sessionStorage.setItem("ticketImeiSerial",ie),sessionStorage.setItem("ticketStatus",oe),sessionStorage.setItem("ticketTechnicianId",ce),sessionStorage.setItem("ticketPaymentStatus",J),sessionStorage.setItem("ticketAmountPaid",me.toString())}catch(t){console.error("Error saving form state to sessionStorage:",t)}},[Ie,R,L,k,h,T,f,se,re,oe,ce,J,me]);const qe=w.filter(t=>{var s,a,o,d,S,U,ge,$,C,he;if(i===b.TECHNICIAN&&N&&t.technicianId!==N.uid||l!=="all"&&t.status!==l)return!1;if(Ne){const c=x.find(Q=>Q.id===t.clientId),j=Ne.toLowerCase();switch(ue){case"tasks":return t.tasks.some(Q=>Q.toLowerCase().includes(j));case"client":return((s=c==null?void 0:c.name)==null?void 0:s.toLowerCase().includes(j))||((a=c==null?void 0:c.email)==null?void 0:a.toLowerCase().includes(j))||((o=c==null?void 0:c.phone)==null?void 0:o.toLowerCase().includes(j));case"ticket":return(d=t.ticketNumber)==null?void 0:d.toLowerCase().includes(j);case"all":default:return((S=t.ticketNumber)==null?void 0:S.toLowerCase().includes(j))||((U=t.deviceType)==null?void 0:U.toLowerCase().includes(j))||((ge=t.brand)==null?void 0:ge.toLowerCase().includes(j))||(($=c==null?void 0:c.name)==null?void 0:$.toLowerCase().includes(j))||((C=c==null?void 0:c.email)==null?void 0:C.toLowerCase().includes(j))||((he=c==null?void 0:c.phone)==null?void 0:he.toLowerCase().includes(j))||t.tasks.some(Q=>Q.toLowerCase().includes(j))}}return!0}).sort((t,s)=>{const a=new Date(t.createdAt).getTime(),o=new Date(s.createdAt).getTime();return Ue==="asc"?a-o:o-a}),Oe=x.filter(t=>{var s,a;return((s=t.name)==null?void 0:s.toLowerCase().includes(R.toLowerCase()))||((a=t.email)==null?void 0:a.toLowerCase().includes(R.toLowerCase()))}),Ve=f.reduce((t,s)=>t+(s.price||0),0),ht=async t=>{var s;t.preventDefault();try{if(!L&&!g){alert("Please select a client");return}const a=f.map(S=>S.name),o=g?((s=w.find(S=>S.id===g))==null?void 0:s.clientId)||"":L;if(!o){alert("Client ID is required");return}const d={deviceType:k,brand:h,model:T,tasks:a,taskPrices:f,issue:se,passcode:re,imeiSerial:ie,status:oe,cost:Ve,technicianId:ce||"",clientId:o,paymentStatus:J,amountPaid:me};if(console.log("Creating ticket with IMEI data:",{imeiSerial:ie,ticketData:d}),g)await u(g,d),ye(null);else{const{addTicket:S}=m.getState(),U=await S(d);_e(U),fe(!0)}g||(Te(!1),O(""),_(""),H(""),G(""),E(""),P([]),ae(""),ne(""),ve(""),de("pending"),le(""),W("not_paid"),K(0),M(!1)),g||(W("not_paid"),K(0))}catch(a){console.error("Error submitting ticket:",a),alert("An error occurred while saving the ticket. Please try again.")}},He=t=>{t.trim()&&P([...f,{name:t.trim(),price:0}])},pt=t=>{P(f.filter(s=>s.name!==t))},yt=(t,s)=>{P(f.map(a=>a.name===t?{...a,price:s}:a))},ft=t=>{const s=x.find(a=>a.id===t);s&&(_(t),O(s.name)),je(!1)},bt=async t=>{if(window.confirm("Are you sure you want to delete this ticket?"))try{await B(t)}catch(s){console.error("Error deleting ticket:",s),alert("An error occurred while deleting the ticket.")}},jt=async t=>{if(t&&window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette facture ?"))try{const{deleteInvoice:s}=Ke.getState();await s(t);const{tickets:a}=m.getState(),o=a.find(d=>d.invoiceId===t);if(o){const{updateDoc:d,doc:S}=await Qe(async()=>{const{updateDoc:$,doc:C}=await import("./vendor-firebase-BDRyz5lN.js").then(he=>he.S);return{updateDoc:$,doc:C}},[]),{db:U}=await Qe(async()=>{const{db:$}=await import("./index-Bn9zpSYO.js").then(C=>C.A);return{db:$}},__vite__mapDeps([0,1,2,3,4,5,6,7])),ge=S(U,"tickets",o.id);await d(ge,{invoiceGenerated:!1,invoiceId:$t()}),m.setState($=>({tickets:$.tickets.map(C=>C.id===o.id?{...C,invoiceGenerated:!1,invoiceId:void 0}:C)}))}alert("Facture supprimÃ©e avec succÃ¨s.")}catch(s){console.error("Error deleting invoice:",s),alert("Une erreur s'est produite lors de la suppression de la facture.")}},Nt=t=>{if(!x.find(a=>a.id===t.clientId)){alert("Client information not found for this ticket.");return}V(t),Ae(!0)},wt=async t=>{if(I)try{const s=await q(I.id,t);alert(`Facture gÃ©nÃ©rÃ©e avec succÃ¨s! ID: ${s}`)}catch(s){console.error("Error generating invoice from ticket:",s),alert(`Erreur lors de la gÃ©nÃ©ration de la facture: ${s.message}`)}finally{V(null)}},Ge=async t=>{try{const s=z.find(d=>d.id===t);if(!s){alert("Facture introuvable. Veuillez rÃ©essayer.");return}const a=x.find(d=>d.id===s.clientId),o={id:s.id,number:s.invoiceNumber,date:s.date,customer:a?{id:a.id,name:a.name||"",email:a.email||"",phone:a.phone||"",address:a.address||"",taxId:a.taxId}:{id:s.clientId,name:"Client inconnu",email:"",phone:"",address:""},items:s.items.map(d=>({id:d.id||`item-${Math.random().toString(36).substring(2,9)}`,name:d.name,quantity:d.quantity||1,price:d.price,description:d.description})),subtotal:s.subtotal,tax:s.tax,total:s.total,paymentStatus:s.paymentStatus,paymentMethod:s.paymentMethod,amountPaid:s.total,type:"invoice",sourceType:"ticket",sourceId:s.ticketId,deviceType:s.deviceType,brand:s.brand,model:s.model,imeiSerial:s.imeiSerial,note:s.note||void 0};Me(o),Ee(!0)}catch(s){console.error("Error viewing invoice:",s),alert("Erreur lors de l'affichage de la facture. Veuillez rÃ©essayer.")}},vt=t=>{const s=Fe.find(a=>a.id===t);return s?s.fullName:"Unassigned"},kt=async t=>{const{addDeviceType:s}=m.getState();await s(t)},Je=t=>!!(i===b.SUPER_ADMIN||i===b.TECHNICIAN&&N&&t.technicianId===(N==null?void 0:N.uid)),St=t=>{switch(t){case"pending":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:"En attente"});case"in-progress":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:"En cours"});case"completed":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"TerminÃ©"});default:return null}},Ct=t=>{switch(t){case"not_paid":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"Non payÃ©"});case"partially_paid":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:"Partiellement payÃ©"});case"fully_paid":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"PayÃ©"});default:return null}},It=async(t,s)=>{const{addModel:a}=m.getState();await a({name:t,brandId:s})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:`text-2xl font-semibold ${n?"text-white":"text-gray-900"}`,children:i===b.TECHNICIAN?"Mes tickets assignÃ©s":"Tickets de rÃ©paration"})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>xe("create"),className:`py-2 px-1 border-b-2 font-medium text-sm ${A==="create"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"CrÃ©er un ticket"}),e.jsx("button",{onClick:()=>xe("all"),className:`py-2 px-1 border-b-2 font-medium text-sm ${A==="all"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Tous les tickets"}),e.jsxs("button",{onClick:()=>xe("invoices"),className:`py-2 px-1 border-b-2 font-medium text-sm ${A==="invoices"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(X,{className:"h-4 w-4 inline mr-1"}),"Toutes les factures"]})]})}),v&&e.jsx("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6 text-center`,children:e.jsx("p",{className:n?"text-white":"text-gray-900",children:"Chargement des tickets..."})}),p&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[e.jsx("strong",{className:"font-bold",children:"Error!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",p]})]}),A==="create"&&e.jsx(e.Fragment,{children:i===b.SUPER_ADMIN&&e.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsx("h2",{className:`text-lg font-semibold mb-4 ${n?"text-white":"text-gray-900"}`,children:g?"Modifier le ticket":"CrÃ©er un nouveau ticket"}),!g&&!be&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Client"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:R,onChange:t=>{O(t.target.value),_(""),we(t.target.value.length>0)},onBlur:()=>{setTimeout(()=>we(!1),200)},placeholder:"Commencez Ã  taper pour rechercher un client...",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),e.jsx("button",{type:"button",onClick:()=>je(!0),className:"mt-1 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Nouveau client"})]}),mt&&R&&!L&&!be&&Oe.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:Oe.map(t=>e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{_(t.id),O(t.name),we(!1)},children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email})]},t.id))})]})]}),be?e.jsx(Vt,{onSubmit:ft,onCancel:()=>je(!1)}):e.jsxs("form",{onSubmit:ht,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Type d'appareil"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:k,onChange:t=>{M(!0),H(t.target.value),Y(t.target.value.length>0)},onBlur:()=>{setTimeout(()=>Y(!1),200)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Commencez Ã  taper pour rechercher un type d'appareil",required:!0,onKeyDown:t=>{if(t.key==="Enter")return t.preventDefault(),!1}}),ot&&k&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[m.getState().settings.deviceTypes.filter(t=>t.toLowerCase().includes(k.toLowerCase())).map(t=>e.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{H(t),Y(!1)},children:t},t)),k&&!m.getState().settings.deviceTypes.some(t=>t.toLowerCase()===k.toLowerCase())&&e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{await kt(k),Y(!1)},children:['Add "',k,'"']})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Marque"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:h,onChange:t=>{M(!0),G(t.target.value),Z(t.target.value.length>0),t.target.value||E("")},onBlur:()=>{setTimeout(()=>Z(!1),200)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Commencez Ã  taper pour rechercher une marque",required:!0,onKeyDown:t=>{if(t.key==="Enter")return t.preventDefault(),!1}}),dt&&h&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[m.getState().settings.brands.filter(t=>t.toLowerCase().includes(h.toLowerCase())).map(t=>e.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{G(t),E(""),Z(!1)},children:t},t)),h&&!m.getState().settings.brands.some(t=>t.toLowerCase()===h.toLowerCase())&&e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{const{addBrand:t}=m.getState();try{await t(h),E("")}catch(s){console.error("Error adding brand:",s)}Z(!1)},children:['Add "',h,'"']})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"ModÃ¨le"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:T,onChange:t=>{M(!0),E(t.target.value),ee(t.target.value.length>0)},onBlur:()=>{setTimeout(()=>ee(!1),200)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Commencez Ã  taper pour rechercher un modÃ¨le",required:!0,disabled:!h,onKeyDown:t=>{if(t.key==="Enter")return t.preventDefault(),!1}}),ct&&h&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[m.getState().settings.models.filter(t=>t.brandId===h&&t.name.toLowerCase().includes(T.toLowerCase())).map(t=>e.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{E(t.name),ee(!1)},children:t.name},t.id)),T&&!m.getState().settings.models.some(t=>t.brandId===h&&t.name.toLowerCase()===T.toLowerCase())&&e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{await It(T,h),ee(!1)},children:['Add "',T,'"']})]})]})]}),i===b.SUPER_ADMIN&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Assigner Ã  un technicien"}),e.jsxs("select",{value:ce,onChange:t=>le(t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Non assignÃ©"}),Fe.map(t=>e.jsx("option",{value:t.id,children:t.fullName},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"TÃ¢ches"}),e.jsxs("div",{className:`text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:["CoÃ»t total: â‚¬",Ve.toFixed(2)]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:F,onChange:t=>{ke(t.target.value),te(t.target.value.length>0)},onBlur:()=>{setTimeout(()=>te(!1),200)},placeholder:"Commencez Ã  taper pour rechercher une tÃ¢che",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onKeyDown:t=>{if(t.key==="Enter")return t.preventDefault(),!1}}),lt&&F&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[m.getState().settings.tasks.filter(t=>t.toLowerCase().includes(F.toLowerCase())).slice(0,5).map(t=>e.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{He(t),ke(""),te(!1)},children:t},t)),F&&!m.getState().settings.tasks.some(t=>t.toLowerCase()===F.toLowerCase())&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{const t=F,s=ze,a=[...f,{name:t,price:s}];sessionStorage.setItem("ticketTasksWithPrice",JSON.stringify(a)),P(a),M(!0);const{addTask:o}=m.getState();try{await o(t)}catch(d){console.error("Error adding task:",d)}ke(""),Re(0),te(!1)},children:['Add "',F,'"']}),e.jsxs("div",{className:"px-4 py-2 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"Price:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:"â‚¬"}),e.jsx("input",{type:"number",value:ze,onChange:t=>Re(Number(t.target.value)),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onClick:t=>t.stopPropagation()})]})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:`text-sm font-medium mb-2 ${n?"text-gray-300":"text-gray-700"}`,children:"TÃ¢ches populaires"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Array.from(m.getState().tickets.flatMap(t=>t.tasks).reduce((t,s)=>(t.set(s,(t.get(s)||0)+1),t),new Map).entries()).sort((t,s)=>s[1]-t[1]).slice(0,6).map(([t])=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:f.some(s=>s.name===t),onChange:()=>{M(!0),f.some(a=>a.name===t)?P(a=>a.filter(o=>o.name!==t)):He(t)},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:n?"text-gray-300":"text-gray-700",children:t})]},t))})]}),f.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:`text-sm font-medium mb-2 ${n?"text-gray-300":"text-gray-700"}`,children:"TÃ¢ches sÃ©lectionnÃ©es"}),e.jsx("div",{className:"space-y-2 border rounded-md p-3",children:f.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{type:"button",onClick:()=>pt(t.name),className:"mr-2 text-red-500 hover:text-red-700",children:"Supprimer"}),e.jsx("span",{className:n?"text-gray-300":"text-gray-700",children:t.name})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:"â‚¬"}),e.jsx("input",{type:"number",value:t.price,onChange:s=>yt(t.name,Number(s.target.value)),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]})]},t.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Code de dÃ©verrouillage (optionnel)"}),e.jsx("input",{type:"text",value:re,onChange:t=>ne(t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"IMEI / NumÃ©ro de SÃ©rie (optionnel)"}),e.jsx("input",{type:"text",value:ie,onChange:t=>ve(t.target.value),placeholder:"Entrez l'IMEI ou le numÃ©ro de sÃ©rie",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Description du problÃ¨me (optionnel)"}),e.jsx("textarea",{value:se,onChange:t=>ae(t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),g&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Statut"}),e.jsxs("select",{value:oe,onChange:t=>de(t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"in-progress",children:"En cours"}),e.jsx("option",{value:"completed",children:"TerminÃ©"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Statut du paiement"}),e.jsxs("select",{value:J,onChange:t=>W(t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"not_paid",children:"Non payÃ©"}),e.jsx("option",{value:"partially_paid",children:"Partiellement payÃ©"}),e.jsx("option",{value:"fully_paid",children:"PayÃ©"})]})]}),J==="partially_paid"&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Montant payÃ© (â‚¬)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:me,onChange:t=>K(parseFloat(t.target.value)||0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"0.00"})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{Te(!1),ye(null),O(""),_(""),H(""),G(""),E(""),P([]),ae(""),ne(""),de("pending"),le(""),W("not_paid"),K(0),M(!1)},className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:v,children:"Annuler"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",disabled:v,children:v?g?"Mise Ã  jour...":"CrÃ©ation...":g?"Mettre Ã  jour le ticket":"CrÃ©er le ticket"})]})]})]})}),A==="all"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 space-y-4 sm:space-y-0 sm:flex sm:items-center sm:gap-4",children:[e.jsxs("select",{value:ue,onChange:t=>xt(t.target.value),className:"w-full sm:w-40 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"Tout rechercher"}),e.jsx("option",{value:"ticket",children:"NumÃ©ro de ticket"}),e.jsx("option",{value:"client",children:"Informations client"}),e.jsx("option",{value:"tasks",children:"TÃ¢ches"})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-4 bg-white dark:bg-gray-700 p-4 rounded-lg shadow-inner",children:[e.jsx(zt,{className:"h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:`Rechercher des ${ue==="all"?"tickets":ue}...`,value:Ne,onChange:t=>nt(t.target.value),className:"flex-1 bg-transparent border-0 focus:ring-0 text-gray-900 dark:text-white placeholder-gray-400"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:l,onChange:t=>D(t.target.value),className:"rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"Tous les statuts"}),e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"in-progress",children:"En cours"}),e.jsx("option",{value:"completed",children:"TerminÃ©"})]}),e.jsxs("button",{onClick:()=>ut(t=>t==="asc"?"desc":"asc"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",title:"Trier par date",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:Ue==="asc"?"Plus ancien d'abord":"Plus rÃ©cent d'abord"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:n?"bg-gray-700":"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Ticket #"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Appareil"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"TÃ¢ches"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"CoÃ»t"}),i===b.SUPER_ADMIN&&e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Technicien"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider min-w-[120px] w-[180px] sm:w-[160px] md:w-[180px]",children:"Paiement"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider min-w-[120px]",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y divide-gray-200 dark:divide-gray-700 ${n?"bg-gray-800":"bg-white"}`,children:qe.length>0?qe.map(t=>{const s=x.find(o=>o.id===t.clientId),a=t.taskPrices?t.taskPrices.map(o=>`${o.name} (â‚¬${o.price})`).join(", "):t.tasks.join(", ");return e.jsxs("tr",{className:`hover:${n?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:["#",t.ticketNumber]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Rt,{className:"h-4 w-4 mr-2 text-gray-400"}),(s==null?void 0:s.name)||"Unknown Client"]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:[t.deviceType," - ",t.brand]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300 max-w-xs truncate",children:a}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["â‚¬",t.cost]}),i===b.SUPER_ADMIN&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.technicianId?vt(t.technicianId):"Unassigned"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:Je(t)?e.jsxs("select",{value:t.status,onChange:o=>u(t.id,{status:o.target.value}),className:"text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"in-progress",children:"En cours"}),e.jsx("option",{value:"completed",children:"TerminÃ©"})]}):St(t.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:Ct(t.paymentStatus||"not_paid")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"h-4 w-4 mr-2 text-gray-400"}),t.createdAt?Ze(new Date(t.createdAt),"MMM d, yyyy"):"Unknown"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:e.jsxs("div",{className:"flex justify-center space-x-3",children:[Je(t)&&e.jsx("button",{onClick:()=>{ye(t.id),xe("create")},className:"text-blue-600 hover:text-blue-800",title:"Edit",children:e.jsx(Ut,{className:"h-5 w-5"})}),t.paymentStatus==="fully_paid"&&!t.invoiceGenerated&&e.jsx("button",{onClick:()=>Nt(t),className:"text-blue-600 hover:text-blue-800",title:"GÃ©nÃ©rer Facture",children:e.jsx(Bt,{className:"h-5 w-5"})}),t.invoiceGenerated&&t.invoiceId&&e.jsx("button",{onClick:()=>Ge(t.invoiceId),className:"text-green-600 hover:text-green-800",title:"Voir Facture",children:e.jsx(qt,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{_e(t.ticketNumber),_(t.clientId),fe(!0)},className:"text-indigo-600 hover:text-indigo-800",title:"Generate Document",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{if(!x.find(d=>d.id===t.clientId)){alert("Client information not found for this ticket.");return}V(t),_(t.clientId),De(!0)},className:"text-purple-600 hover:text-purple-800",title:"GÃ©nÃ©rer Contrat d'Engagement",children:e.jsx(Ot,{className:"h-5 w-5"})}),i===b.SUPER_ADMIN&&e.jsx("button",{onClick:()=>bt(t.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx(Ye,{className:"h-5 w-5"})})]})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:i===b.SUPER_ADMIN?9:8,className:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:i===b.TECHNICIAN?"No tickets assigned to you yet":"No tickets found"})})})]})})]})}),A==="invoices"&&e.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:`text-xl font-semibold ${n?"text-white":"text-gray-900"}`,children:"Toutes les factures de rÃ©paration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>gt(t=>t==="asc"?"desc":"asc"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",title:"Trier par date",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:Be==="asc"?"Plus ancien d'abord":"Plus rÃ©cent d'abord"})]}),e.jsx("button",{onClick:()=>{setTimeout(()=>{},500)},className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700",children:"Actualiser"})]})]}),e.jsx("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:"ðŸ’¡"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:`text-sm font-medium ${n?"text-blue-200":"text-blue-800"}`,children:"Comment gÃ©nÃ©rer des factures"}),e.jsx("div",{className:`mt-2 text-sm ${n?"text-blue-300":"text-blue-700"}`,children:e.jsx("p",{children:`Les factures sont gÃ©nÃ©rÃ©es automatiquement Ã  partir des tickets de rÃ©paration payÃ©s intÃ©gralement. Allez dans l'onglet "Tous les tickets", trouvez un ticket avec le statut "PayÃ©" et cliquez sur le bouton ðŸ’° pour gÃ©nÃ©rer sa facture.`})})]})]})}),z.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:`text-lg ${n?"text-gray-400":"text-gray-500"}`,children:"Aucune facture gÃ©nÃ©rÃ©e"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Les factures apparaÃ®tront ici une fois gÃ©nÃ©rÃ©es Ã  partir des tickets payÃ©s"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:n?"bg-gray-700":"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Facture #"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Ticket #"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Appareil"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y divide-gray-200 dark:divide-gray-700 ${n?"bg-gray-800":"bg-white"}`,children:z.sort((t,s)=>{const a=new Date(t.date).getTime(),o=new Date(s.date).getTime();return Be==="asc"?a-o:o-a}).map(t=>{w.find(a=>a.id===t.ticketId);const s=x.find(a=>a.id===t.clientId);return e.jsxs("tr",{className:`hover:${n?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.invoiceNumber}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["#",t.ticketNumber]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:(s==null?void 0:s.name)||"Client inconnu"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.deviceType&&t.brand?`${t.deviceType} - ${t.brand}${t.model?` ${t.model}`:""}`:"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"PayÃ©"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:["â‚¬",t.total.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"h-4 w-4 mr-2 text-gray-400"}),Ze(new Date(t.date),"MMM d, yyyy")]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>Ge(t.id),className:"text-indigo-600 hover:text-indigo-800",title:"Voir la facture",children:e.jsx(X,{className:"h-5 w-5"})}),i===b.SUPER_ADMIN&&t.id&&e.jsx("button",{onClick:()=>jt(t.id),className:"text-red-600 hover:text-red-800",title:"Supprimer la facture",children:e.jsx(Ye,{className:"h-5 w-5"})})]})})]},t.id)})})]})})]}),st&&Le&&e.jsx(Se,{data:Et(w.find(t=>t.ticketNumber===Le),L,x.find(t=>t.id===L)),onClose:()=>fe(!1),initialFormat:"a4"}),rt&&$e&&e.jsx(Se,{data:$e,onClose:()=>{Ee(!1),Me(null)},initialFormat:"a4"}),at&&I&&e.jsx(Se,{data:Pt(I,x.find(t=>t.id===I.clientId)),onClose:()=>{De(!1),V(null)},initialFormat:"a4"}),Pe&&I&&e.jsx(Gt,{isOpen:Pe,onClose:()=>{Ae(!1),V(null)},onConfirm:wt,ticketNumber:I.ticketNumber,clientName:((We=x.find(t=>t.id===I.clientId))==null?void 0:We.name)||"Client inconnu",totalAmount:I.cost})]})}export{ts as default};
