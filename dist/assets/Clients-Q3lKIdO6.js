import{j as e}from"./vendor-pdf-renderer-D4KtQ5U9.js";import{r as n}from"./vendor-react-NkhADs9z.js";import{u as re,b as ie,a as de,e as ne,f as le}from"./index-D5LafrQS.js";import{h as M,U as E,p as oe,m as ce,d as me,C as xe,H as ge,z as he,T as ue,o as ye}from"./vendor-ui--DlbAMRu.js";import{f as $}from"./vendor-utils-BK9ZHHVQ.js";import"./vendor-firebase-CWMDWzYz.js";import"./vendor-pdf-utils-CBrSDip1.js";function $e(){const s=re(t=>t.isDarkMode),{clients:N,addClient:F,updateClient:L,deleteClient:q,loading:X,error:D}=ie(),{tickets:I}=de(),{orders:H}=ne(),{sales:R}=le(),[f,A]=n.useState("main"),[V,z]=n.useState(null),[O,C]=n.useState(null),[U,Q]=n.useState(new Set),[m,y]=n.useState({name:"",email:"",phone:"",address:""}),[x,b]=n.useState({name:"",email:"",phone:"",address:""}),[h,_]=n.useState(""),[o,B]=n.useState("name"),[u,P]=n.useState("asc"),[c,p]=n.useState(1),[v,G]=n.useState(10),g=Math.ceil(N.length/v),S=(c-1)*v,T=S+v,w=n.useMemo(()=>{let t=N;if(h.trim()){const i=h.toLowerCase();t=t.filter(r=>r.name.toLowerCase().includes(i)||r.email.toLowerCase().includes(i)||r.phone.toLowerCase().includes(i)||r.address.toLowerCase().includes(i))}return t.sort((i,r)=>{let l=i[o],d=r[o];return o==="createdAt"?(l=new Date(l).getTime(),d=new Date(d).getTime()):(l=l.toLowerCase(),d=d.toLowerCase()),u==="asc"?l<d?-1:l>d?1:0:l>d?-1:l<d?1:0}),t},[N,h,o,u]),J=w.slice(S,T);n.useMemo(()=>{p(1)},[h]),n.useMemo(()=>{p(1)},[o,u]);const K=async t=>{t.preventDefault(),await F(m),y({name:"",email:"",phone:"",address:""})},W=t=>{const i=I.filter(d=>d.clientId===t),r=H.filter(d=>d.clientId===t),l=R.filter(d=>{var j;return((j=d.customer)==null?void 0:j.id)===t});return{tickets:i,orders:r,sales:l}},Y=async t=>{window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce client ?")&&await q(t)},Z=t=>{const i=N.find(r=>r.id===t);i&&(C(t),b({name:i.name,email:i.email,phone:i.phone,address:i.address}))},ee=async(t,i)=>{t.preventDefault(),await L(i,x),C(null)},se=()=>{C(null),b({name:"",email:"",phone:"",address:""})},te=t=>{Q(i=>{const r=new Set(i);return r.has(t)?r.delete(t):r.add(t),r})},k=t=>{o===t?P(u==="asc"?"desc":"asc"):(B(t),P("asc"))};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:`text-2xl font-semibold ${s?"text-white":"text-gray-900"}`,children:"Clients"}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>A("main"),className:`flex items-center gap-2 py-2 px-1 border-b-2 font-medium text-sm ${f==="main"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(M,{className:"h-4 w-4"}),"CrÃ©er un client"]}),e.jsxs("button",{onClick:()=>A("all"),className:`flex items-center gap-2 py-2 px-1 border-b-2 font-medium text-sm ${f==="all"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(E,{className:"h-4 w-4"}),"Tous les clients (",N.length,")"]})]})}),f==="main"&&e.jsxs("div",{className:`rounded-lg ${s?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(M,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:"CrÃ©er un nouveau client"})]}),e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-2`,children:["Nom ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:m.name,onChange:t=>y({...m,name:t.target.value}),placeholder:"Nom complet du client",className:`w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ${s?"bg-gray-700 border-gray-600 text-white":"bg-white"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-2`,children:"Email"}),e.jsx("input",{type:"email",value:m.email,onChange:t=>y({...m,email:t.target.value}),placeholder:"email@exemple.com",className:`w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ${s?"bg-gray-700 border-gray-600 text-white":"bg-white"}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-2`,children:["TÃ©lÃ©phone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",value:m.phone,onChange:t=>y({...m,phone:t.target.value}),placeholder:"+33 6 XX XX XX XX",className:`w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ${s?"bg-gray-700 border-gray-600 text-white":"bg-white"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-2`,children:"Adresse"}),e.jsx("textarea",{value:m.address,onChange:t=>y({...m,address:t.target.value}),placeholder:"Adresse complÃ¨te",rows:3,className:`w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ${s?"bg-gray-700 border-gray-600 text-white":"bg-white"}`})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("button",{type:"button",onClick:()=>{y({name:"",email:"",phone:"",address:""})},className:"px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"RÃ©initialiser"}),e.jsxs("button",{type:"submit",className:"px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"CrÃ©er le client"]})]})]})]}),f==="all"&&e.jsxs(e.Fragment,{children:[X&&e.jsx("div",{className:`rounded-lg ${s?"bg-gray-800":"bg-white"} shadow p-6 text-center`,children:e.jsx("p",{className:s?"text-white":"text-gray-900",children:"Chargement des clients..."})}),D&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[e.jsx("strong",{className:"font-bold",children:"Error!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",D]})]}),e.jsx("div",{className:`rounded-lg ${s?"bg-gray-800":"bg-white"} shadow p-4`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ce,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher des clients...",value:h,onChange:t=>_(t.target.value),className:`w-full pl-10 pr-4 py-2 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ${s?"bg-gray-700 border-gray-600 text-white":"bg-white"}`})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>k("name"),className:`px-3 py-2 text-sm rounded-md border ${o==="name"?"bg-indigo-100 text-indigo-700 border-indigo-300":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:["Nom ",o==="name"&&(u==="asc"?"â†‘":"â†“")]}),e.jsxs("button",{onClick:()=>k("email"),className:`px-3 py-2 text-sm rounded-md border ${o==="email"?"bg-indigo-100 text-indigo-700 border-indigo-300":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:["Email ",o==="email"&&(u==="asc"?"â†‘":"â†“")]}),e.jsxs("button",{onClick:()=>k("createdAt"),className:`px-3 py-2 text-sm rounded-md border ${o==="createdAt"?"bg-indigo-100 text-indigo-700 border-indigo-300":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:["Date ",o==="createdAt"&&(u==="asc"?"â†‘":"â†“")]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[w.length===0?e.jsxs("div",{className:`rounded-lg ${s?"bg-gray-800":"bg-white"} shadow p-8 text-center`,children:[e.jsx(E,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:`text-lg ${s?"text-gray-400":"text-gray-500"}`,children:h?"Aucun client trouvÃ©":"Aucun client enregistrÃ©"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:h?"Essayez une recherche diffÃ©rente":"Commencez par crÃ©er votre premier client"})]}):J.map(t=>{const{tickets:i,orders:r,sales:l}=W(t.id),d=V===t.id,j=U.has(t.id);return e.jsxs("div",{className:`rounded-lg ${s?"bg-gray-800":"bg-white"} shadow`,children:[e.jsx("div",{className:"p-4",children:O===t.id?e.jsxs("form",{onSubmit:a=>ee(a,t.id),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-1`,children:["Nom ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:x.name,onChange:a=>b({...x,name:a.target.value}),className:`w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ${s?"bg-gray-700 border-gray-600 text-white":"bg-white"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-1`,children:"Email"}),e.jsx("input",{type:"email",value:x.email,onChange:a=>b({...x,email:a.target.value}),className:`w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ${s?"bg-gray-700 border-gray-600 text-white":"bg-white"}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-1`,children:["TÃ©lÃ©phone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",value:x.phone,onChange:a=>b({...x,phone:a.target.value}),className:`w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ${s?"bg-gray-700 border-gray-600 text-white":"bg-white"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s?"text-gray-300":"text-gray-700"} mb-1`,children:"Adresse"}),e.jsx("textarea",{value:x.address,onChange:a=>b({...x,address:a.target.value}),rows:2,className:`w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ${s?"bg-gray-700 border-gray-600 text-white":"bg-white"}`})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white text-sm rounded-md hover:bg-indigo-700",children:"Sauvegarder"}),e.jsx("button",{type:"button",onClick:se,className:"px-4 py-2 border border-gray-300 text-gray-700 text-sm rounded-md hover:bg-gray-50",children:"Annuler"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex justify-between items-start cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors px-4 py-3 -mx-4 -my-3 rounded-lg ${j?"bg-gray-50 dark:bg-gray-700/30":""}`,onClick:a=>{a.target.closest("button")||te(t.id)},children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[j?e.jsx(me,{className:"h-4 w-4 text-indigo-600"}):e.jsx(xe,{className:"h-4 w-4 text-indigo-600"}),e.jsx(M,{className:"h-4 w-4 text-gray-400"})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h3",{className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:t.name}),e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full ${s?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-600"}`,children:["ðŸ“ž ",t.phone]})]})})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),z(d?null:t.id)},className:`p-2 rounded-full ${d?"bg-indigo-100 text-indigo-600":"text-gray-400 hover:text-gray-500"}`,title:"Historique",children:e.jsx(ge,{className:"h-5 w-5"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),Z(t.id)},className:"p-2 text-gray-400 hover:text-gray-500",title:"Modifier",children:e.jsx(he,{className:"h-5 w-5"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),Y(t.id)},className:"p-2 text-gray-400 hover:text-red-500",title:"Supprimer",children:e.jsx(ue,{className:"h-5 w-5"})})]})]}),j&&e.jsx("div",{className:`mt-4 pt-4 border-t ${s?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium mb-1 ${s?"text-gray-300":"text-gray-700"}`,children:"Email"}),e.jsx("p",{className:`text-sm ${s?"text-gray-400":"text-gray-600"}`,children:t.email||"Non spÃ©cifiÃ©"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium mb-1 ${s?"text-gray-300":"text-gray-700"}`,children:"Adresse"}),e.jsx("p",{className:`text-sm ${s?"text-gray-400":"text-gray-600"}`,children:t.address||"Non spÃ©cifiÃ©e"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium mb-1 ${s?"text-gray-300":"text-gray-700"}`,children:"ID Client"}),e.jsx("p",{className:`text-sm font-mono ${s?"text-gray-400":"text-gray-600"}`,children:t.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium mb-1 ${s?"text-gray-300":"text-gray-700"}`,children:"Membre depuis"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:`text-sm ${s?"text-gray-400":"text-gray-600"}`,children:$(new Date(t.createdAt),"MMM d, yyyy")})]})]})]})})]})}),d&&e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h4",{className:`font-semibold ${s?"text-white":"text-gray-900"}`,children:"Historique du client"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:`text-sm font-medium mb-2 ${s?"text-gray-300":"text-gray-700"}`,children:"Tickets de rÃ©paration"}),e.jsx("div",{className:"space-y-2",children:i.length>0?i.map(a=>e.jsxs("div",{className:`p-3 rounded-md ${s?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:s?"text-white":"text-gray-900",children:[a.deviceType," - ",a.brand]}),e.jsxs("span",{className:`text-sm ${s?"text-gray-300":"text-gray-600"}`,children:["â‚¬",a.cost]})]}),e.jsxs("p",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:["TÃ¢ches: ",a.tasks.join(", ")]}),a.issue&&e.jsxs("p",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:["ProblÃ¨me: ",a.issue]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:["Statut: ",a.status]}),e.jsx("span",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:$(new Date(a.createdAt),"MMM d, yyyy")})]})]},a.id)):e.jsx("p",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:"Aucun ticket de rÃ©paration pour le moment"})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:`text-sm font-medium mb-2 ${s?"text-gray-300":"text-gray-700"}`,children:"Historique d'achat"}),e.jsx("div",{className:"space-y-2",children:r.length>0||l.length>0?e.jsxs(e.Fragment,{children:[r.map(a=>e.jsxs("div",{className:`p-3 rounded-md ${s?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:s?"text-white":"text-gray-900",children:["Commande #",a.id]}),e.jsxs("span",{className:`text-sm ${s?"text-gray-300":"text-gray-600"}`,children:["â‚¬",a.total]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:["Type: Commande â€¢ Statut: ",a.status]}),e.jsx("span",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:$(new Date(a.createdAt),"MMM d, yyyy")})]})]},`order-${a.id}`)),l.map(a=>e.jsxs("div",{className:`p-3 rounded-md ${s?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:s?"text-white":"text-gray-900",children:["Facture ",a.invoiceNumber]}),e.jsxs("span",{className:`text-sm ${s?"text-gray-300":"text-gray-600"}`,children:["â‚¬",a.total.toFixed(2)]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("p",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:[a.items.length," article(s): ",a.items.slice(0,2).map(ae=>ae.name).join(", "),a.items.length>2?"...":""]})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:["Type: Vente PDV â€¢ Paiement: ",a.paymentMethod]}),e.jsx("span",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:$(new Date(a.date),"MMM d, yyyy")})]})]},`sale-${a.id}`))]}):e.jsx("p",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:"Aucun historique d'achat pour le moment"})})]})]})]})]},t.id)}),g>1&&e.jsx("div",{className:`rounded-lg ${s?"bg-gray-800":"bg-white"} shadow p-4`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:`text-sm ${s?"text-gray-400":"text-gray-600"}`,children:["Affichage de ",S+1,"-",Math.min(T,w.length)," sur ",w.length," clients"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm ${s?"text-gray-400":"text-gray-600"}`,children:"Par page:"}),e.jsxs("select",{value:v,onChange:t=>{G(Number(t.target.value)),p(1)},className:`rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ${s?"bg-gray-700 border-gray-600 text-white":"bg-white"}`,children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>p(Math.max(1,c-1)),disabled:c===1,className:`px-3 py-2 text-sm rounded-md border ${c===1?"border-gray-300 text-gray-400 cursor-not-allowed":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"PrÃ©cÃ©dent"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,g)},(t,i)=>{let r;return g<=5||c<=3?r=i+1:c>=g-2?r=g-4+i:r=c-2+i,e.jsx("button",{onClick:()=>p(r),className:`px-3 py-2 text-sm rounded-md border ${c===r?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:r},r)})}),e.jsx("button",{onClick:()=>p(Math.min(g,c+1)),disabled:c===g,className:`px-3 py-2 text-sm rounded-md border ${c===g?"border-gray-300 text-gray-400 cursor-not-allowed":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"Suivant"})]})]})})]})]})]})}export{$e as default};
