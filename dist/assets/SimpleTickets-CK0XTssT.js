const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Chm39M27.js","assets/vendor-pdf-renderer-DliE_hgd.js","assets/vendor-react-Bpbu6kUi.js","assets/vendor-firebase-CP8F7PJ2.js","assets/vendor-utils-CAoL40rE.js","assets/vendor-ui-Dxk9kMFY.js","assets/vendor-pdf-utils-CBrSDip1.js","assets/index-C9h5JUuT.css"])))=>i.map(i=>d[i]);
import{u as Xe,b as Ye,g as kt,a as l,d as St,f as Ge,R as p,U as ke,h as Ct,i as It,j as Tt,_ as Je}from"./index-Chm39M27.js";import{j as e}from"./vendor-pdf-renderer-DliE_hgd.js";import{r as a}from"./vendor-react-Bpbu6kUi.js";import{P as Dt}from"./vendor-firebase-CP8F7PJ2.js";import{F as me,n as Et,p as ue,J as We,h as At,K as Pt,N as $t,O as Lt,Q as Mt,T as Ke}from"./vendor-ui-Dxk9kMFY.js";import{f as Qe}from"./vendor-utils-CAoL40rE.js";import"./vendor-pdf-utils-CBrSDip1.js";function _t({onSubmit:n,onCancel:A}){const g=Xe(o=>o.isDarkMode),{addClient:xe,loading:k}=Ye(),[y,S]=a.useState({name:"",email:"",phone:"",address:""}),[G,b]=a.useState("");a.useEffect(()=>{b(kt())},[]);const C=async o=>{o.preventDefault();const ge={...y,customerCode:G},_=await xe(ge);_?n(_):console.error("Failed to create client")};return e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${g?"text-gray-300":"text-gray-700"}`,children:"Name"}),e.jsx("input",{type:"text",value:y.name,onChange:o=>S({...y,name:o.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${g?"text-gray-300":"text-gray-700"}`,children:"Email (Optional)"}),e.jsx("input",{type:"email",value:y.email,onChange:o=>S({...y,email:o.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${g?"text-gray-300":"text-gray-700"}`,children:"Phone"}),e.jsx("input",{type:"tel",value:y.phone,onChange:o=>S({...y,phone:o.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${g?"text-gray-300":"text-gray-700"}`,children:"Address (Optional)"}),e.jsx("textarea",{value:y.address,onChange:o=>S({...y,address:o.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsx("div",{className:`p-4 rounded-lg ${g?"bg-indigo-900 border border-indigo-700":"bg-indigo-50 border border-indigo-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-full ${g?"bg-indigo-800":"bg-indigo-100"}`,children:e.jsx("svg",{className:`h-5 w-5 ${g?"text-indigo-400":"text-indigo-600"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:`text-sm font-medium ${g?"text-indigo-200":"text-indigo-800"}`,children:"Code d'accÃ¨s client"}),e.jsx("p",{className:`text-lg font-mono font-bold ${g?"text-indigo-100":"text-indigo-900"}`,children:G}),e.jsx("p",{className:`text-xs mt-1 ${g?"text-indigo-300":"text-indigo-600"}`,children:"Donnez ce code au client pour qu'il puisse accÃ©der Ã  ses rÃ©parations"})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:A,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:k,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",disabled:k,children:k?"Creating...":"Create Client"})]})]})}function Vt(){const n=Xe(t=>t.isDarkMode),{tickets:A,updateTicket:g,deleteTicket:xe,loading:k,error:y,filterStatus:S,setFilterStatus:G}=l(),{clients:b}=Ye(),{user:C,userRole:o}=St(),{createInvoiceFromTicket:ge,invoices:_,fetchInvoices:Se}=Ge(),x=a.useRef(!sessionStorage.getItem("ticketSessionActive"));x.current&&(sessionStorage.clear(),sessionStorage.setItem("ticketSessionActive","true"));const[Ce,P]=a.useState(()=>{try{return JSON.parse(sessionStorage.getItem("ticketFormStarted")||"false")}catch{return!1}}),[Ft,Ie]=a.useState(!1),[m,he]=a.useState(null),[F,U]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketClientSearch")||""}catch{return""}return""}),[$,L]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketSelectedClientId")||""}catch{return""}return""}),[Ze,pe]=a.useState(!1),[et,Te]=a.useState(!1),[tt,De]=a.useState(!1),[ye,Ee]=a.useState(null),[Ae,Pe]=a.useState(null),[$e,Le]=a.useState(""),[fe,be]=a.useState(!1),[we,st]=a.useState(""),[Me,rt]=a.useState([]),[at,J]=a.useState(!1),[nt,W]=a.useState(!1),[it,K]=a.useState(!1),[ot,Q]=a.useState(!1),[ct,je]=a.useState(!1),[w,z]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketDeviceType")||""}catch{return""}return""}),[u,B]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketBrand")||""}catch{return""}return""}),[N,I]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketModel")||""}catch{return""}return""}),[h,T]=a.useState(()=>{if(!x.current)try{const t=sessionStorage.getItem("ticketTasksWithPrice");return t?JSON.parse(t):[]}catch{return[]}return[]}),[X,Y]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketIssue")||""}catch{return""}return""}),[Z,ee]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketPasscode")||""}catch{return""}return""}),[te,ve]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketImeiSerial")||""}catch{return""}return""}),[se,re]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketStatus")||"pending"}catch{return"pending"}return"pending"}),[ae,ne]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketTechnicianId")||""}catch{return""}return""}),[q,O]=a.useState(()=>{if(!x.current)try{return sessionStorage.getItem("ticketPaymentStatus")||"not_paid"}catch{return"not_paid"}return"not_paid"}),[ie,H]=a.useState(()=>{if(!x.current)try{return parseFloat(sessionStorage.getItem("ticketAmountPaid")||"0")}catch{return 0}return 0}),[M,Ne]=a.useState(""),[_e,Fe]=a.useState(0),[Re,dt]=a.useState("desc"),[oe,lt]=a.useState("all"),[Ue,mt]=a.useState("desc"),[D,ce]=a.useState("all");a.useEffect(()=>{D==="invoices"&&Se()},[D,Se]),a.useEffect(()=>{(async()=>{try{if(o===p.SUPER_ADMIN){const s=await Tt();rt(s||[])}}catch(s){console.error("Error fetching technicians:",s)}})()},[o]),a.useEffect(()=>{if(m){const t=A.find(s=>s.id===m);t&&(z(t.deviceType||""),B(t.brand||""),I(t.model||""),Y(t.issue||""),ee(t.passcode||""),ve(t.imeiSerial||""),H(t.amountPaid||0),T(t.taskPrices||t.tasks.map(s=>({name:s,price:t.cost/(t.tasks.length||1)}))),re(t.status||"pending"),ne(t.technicianId||""),O(t.paymentStatus||"not_paid"))}},[m]),a.useEffect(()=>{try{sessionStorage.setItem("ticketFormStarted",JSON.stringify(Ce)),sessionStorage.setItem("ticketClientSearch",F),sessionStorage.setItem("ticketSelectedClientId",$),sessionStorage.setItem("ticketDeviceType",w),sessionStorage.setItem("ticketBrand",u),sessionStorage.setItem("ticketModel",N),sessionStorage.setItem("ticketTasksWithPrice",JSON.stringify(h)),sessionStorage.setItem("ticketIssue",X),sessionStorage.setItem("ticketPasscode",Z),sessionStorage.setItem("ticketImeiSerial",te),sessionStorage.setItem("ticketStatus",se),sessionStorage.setItem("ticketTechnicianId",ae),sessionStorage.setItem("ticketPaymentStatus",q),sessionStorage.setItem("ticketAmountPaid",ie.toString())}catch(t){console.error("Error saving form state to sessionStorage:",t)}},[Ce,F,$,w,u,N,h,X,Z,se,ae,q,ie]);const ze=A.filter(t=>{var s,r,i,c,j,R,de,E,v,le;if(o===p.TECHNICIAN&&C&&t.technicianId!==C.uid||S!=="all"&&t.status!==S)return!1;if(we){const d=b.find(V=>V.id===t.clientId),f=we.toLowerCase();switch(oe){case"tasks":return t.tasks.some(V=>V.toLowerCase().includes(f));case"client":return((s=d==null?void 0:d.name)==null?void 0:s.toLowerCase().includes(f))||((r=d==null?void 0:d.email)==null?void 0:r.toLowerCase().includes(f))||((i=d==null?void 0:d.phone)==null?void 0:i.toLowerCase().includes(f));case"ticket":return(c=t.ticketNumber)==null?void 0:c.toLowerCase().includes(f);case"all":default:return((j=t.ticketNumber)==null?void 0:j.toLowerCase().includes(f))||((R=t.deviceType)==null?void 0:R.toLowerCase().includes(f))||((de=t.brand)==null?void 0:de.toLowerCase().includes(f))||((E=d==null?void 0:d.name)==null?void 0:E.toLowerCase().includes(f))||((v=d==null?void 0:d.email)==null?void 0:v.toLowerCase().includes(f))||((le=d==null?void 0:d.phone)==null?void 0:le.toLowerCase().includes(f))||t.tasks.some(V=>V.toLowerCase().includes(f))}}return!0}).sort((t,s)=>{const r=new Date(t.createdAt).getTime(),i=new Date(s.createdAt).getTime();return Re==="asc"?r-i:i-r}),Be=b.filter(t=>{var s,r;return((s=t.name)==null?void 0:s.toLowerCase().includes(F.toLowerCase()))||((r=t.email)==null?void 0:r.toLowerCase().includes(F.toLowerCase()))}),qe=h.reduce((t,s)=>t+(s.price||0),0),ut=async t=>{var s;t.preventDefault();try{if(!$&&!m){alert("Please select a client");return}const r=h.map(j=>j.name),i=m?((s=A.find(j=>j.id===m))==null?void 0:s.clientId)||"":$;if(!i){alert("Client ID is required");return}const c={deviceType:w,brand:u,model:N,tasks:r,taskPrices:h,issue:X,passcode:Z,imeiSerial:te,status:se,cost:qe,technicianId:ae||"",clientId:i,paymentStatus:q,amountPaid:ie};if(console.log("Creating ticket with IMEI data:",{imeiSerial:te,ticketData:c}),m)await g(m,c),he(null);else{const{addTicket:j}=l.getState(),R=await j(c);Le(R),pe(!0)}m||(Ie(!1),U(""),L(""),z(""),B(""),I(""),T([]),Y(""),ee(""),ve(""),re("pending"),ne(""),O("not_paid"),H(0),P(!1)),m||(O("not_paid"),H(0))}catch(r){console.error("Error submitting ticket:",r),alert("An error occurred while saving the ticket. Please try again.")}},Oe=t=>{t.trim()&&T([...h,{name:t.trim(),price:0}])},xt=t=>{T(h.filter(s=>s.name!==t))},gt=(t,s)=>{T(h.map(r=>r.name===t?{...r,price:s}:r))},ht=t=>{const s=b.find(r=>r.id===t);s&&(L(t),U(s.name)),be(!1)},pt=async t=>{if(window.confirm("Are you sure you want to delete this ticket?"))try{await xe(t)}catch(s){console.error("Error deleting ticket:",s),alert("An error occurred while deleting the ticket.")}},yt=async t=>{if(t&&window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette facture ?"))try{const{deleteInvoice:s}=Ge.getState();await s(t);const{tickets:r}=l.getState(),i=r.find(c=>c.invoiceId===t);if(i){const{updateDoc:c,doc:j}=await Je(async()=>{const{updateDoc:E,doc:v}=await import("./vendor-firebase-CP8F7PJ2.js").then(le=>le.R);return{updateDoc:E,doc:v}},[]),{db:R}=await Je(async()=>{const{db:E}=await import("./index-Chm39M27.js").then(v=>v.A);return{db:E}},__vite__mapDeps([0,1,2,3,4,5,6,7])),de=j(R,"tickets",i.id);await c(de,{invoiceGenerated:!1,invoiceId:Dt()}),l.setState(E=>({tickets:E.tickets.map(v=>v.id===i.id?{...v,invoiceGenerated:!1,invoiceId:void 0}:v)}))}alert("Facture supprimÃ©e avec succÃ¨s.")}catch(s){console.error("Error deleting invoice:",s),alert("Une erreur s'est produite lors de la suppression de la facture.")}},ft=async t=>{try{const s=await ge(t.id);alert(`Facture gÃ©nÃ©rÃ©e avec succÃ¨s! ID: ${s}`)}catch(s){console.error("Error generating invoice from ticket:",s),alert(`Erreur lors de la gÃ©nÃ©ration de la facture: ${s.message}`)}},He=async t=>{try{const s=_.find(c=>c.id===t);if(!s){alert("Facture introuvable. Veuillez rÃ©essayer.");return}const r=b.find(c=>c.id===s.clientId),i={id:s.id,number:s.invoiceNumber,date:s.date,customer:r?{id:r.id,name:r.name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",taxId:r.taxId}:{id:s.clientId,name:"Client inconnu",email:"",phone:"",address:""},items:s.items.map(c=>({id:c.id||`item-${Math.random().toString(36).substring(2,9)}`,name:c.name,quantity:c.quantity||1,price:c.price,description:c.description})),subtotal:s.subtotal,tax:s.tax,total:s.total,paymentStatus:s.paymentStatus,paymentMethod:s.paymentMethod,amountPaid:s.total,type:"invoice",sourceType:"ticket",sourceId:s.ticketId,deviceType:s.deviceType,brand:s.brand,model:s.model,imeiSerial:s.imeiSerial,note:s.note||void 0};Pe(i),De(!0)}catch(s){console.error("Error viewing invoice:",s),alert("Erreur lors de l'affichage de la facture. Veuillez rÃ©essayer.")}},bt=t=>{const s=Me.find(r=>r.id===t);return s?s.fullName:"Unassigned"},wt=async t=>{const{addDeviceType:s}=l.getState();await s(t)},Ve=t=>!!(o===p.SUPER_ADMIN||o===p.TECHNICIAN&&C&&t.technicianId===(C==null?void 0:C.uid)),jt=t=>{switch(t){case"pending":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:"En attente"});case"in-progress":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:"En cours"});case"completed":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"TerminÃ©"});default:return null}},vt=t=>{switch(t){case"not_paid":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"Non payÃ©"});case"partially_paid":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:"Partiellement payÃ©"});case"fully_paid":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"PayÃ©"});default:return null}},Nt=async(t,s)=>{const{addModel:r}=l.getState();await r({name:t,brandId:s})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:`text-2xl font-semibold ${n?"text-white":"text-gray-900"}`,children:o===p.TECHNICIAN?"Mes tickets assignÃ©s":"Tickets de rÃ©paration"})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>ce("create"),className:`py-2 px-1 border-b-2 font-medium text-sm ${D==="create"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"CrÃ©er un ticket"}),e.jsx("button",{onClick:()=>ce("all"),className:`py-2 px-1 border-b-2 font-medium text-sm ${D==="all"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Tous les tickets"}),e.jsxs("button",{onClick:()=>ce("invoices"),className:`py-2 px-1 border-b-2 font-medium text-sm ${D==="invoices"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(me,{className:"h-4 w-4 inline mr-1"}),"Toutes les factures"]})]})}),k&&e.jsx("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6 text-center`,children:e.jsx("p",{className:n?"text-white":"text-gray-900",children:"Chargement des tickets..."})}),y&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[e.jsx("strong",{className:"font-bold",children:"Error!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",y]})]}),D==="create"&&e.jsx(e.Fragment,{children:o===p.SUPER_ADMIN&&e.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsx("h2",{className:`text-lg font-semibold mb-4 ${n?"text-white":"text-gray-900"}`,children:m?"Modifier le ticket":"CrÃ©er un nouveau ticket"}),!m&&!fe&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Client"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:F,onChange:t=>{U(t.target.value),L(""),je(t.target.value.length>0)},onBlur:()=>{setTimeout(()=>je(!1),200)},placeholder:"Commencez Ã  taper pour rechercher un client...",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),e.jsx("button",{type:"button",onClick:()=>be(!0),className:"mt-1 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Nouveau client"})]}),ct&&F&&!$&&!fe&&Be.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:Be.map(t=>e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{L(t.id),U(t.name),je(!1)},children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email})]},t.id))})]})]}),fe?e.jsx(_t,{onSubmit:ht,onCancel:()=>be(!1)}):e.jsxs("form",{onSubmit:ut,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Type d'appareil"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:w,onChange:t=>{P(!0),z(t.target.value),J(t.target.value.length>0)},onBlur:()=>{setTimeout(()=>J(!1),200)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Commencez Ã  taper pour rechercher un type d'appareil",required:!0,onKeyDown:t=>{if(t.key==="Enter")return t.preventDefault(),!1}}),at&&w&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[l.getState().settings.deviceTypes.filter(t=>t.toLowerCase().includes(w.toLowerCase())).map(t=>e.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{z(t),J(!1)},children:t},t)),w&&!l.getState().settings.deviceTypes.some(t=>t.toLowerCase()===w.toLowerCase())&&e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{await wt(w),J(!1)},children:['Add "',w,'"']})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Marque"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u,onChange:t=>{P(!0),B(t.target.value),W(t.target.value.length>0),t.target.value||I("")},onBlur:()=>{setTimeout(()=>W(!1),200)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Commencez Ã  taper pour rechercher une marque",required:!0,onKeyDown:t=>{if(t.key==="Enter")return t.preventDefault(),!1}}),nt&&u&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[l.getState().settings.brands.filter(t=>t.toLowerCase().includes(u.toLowerCase())).map(t=>e.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{B(t),I(""),W(!1)},children:t},t)),u&&!l.getState().settings.brands.some(t=>t.toLowerCase()===u.toLowerCase())&&e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{const{addBrand:t}=l.getState();try{await t(u),I("")}catch(s){console.error("Error adding brand:",s)}W(!1)},children:['Add "',u,'"']})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"ModÃ¨le"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:N,onChange:t=>{P(!0),I(t.target.value),K(t.target.value.length>0)},onBlur:()=>{setTimeout(()=>K(!1),200)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Commencez Ã  taper pour rechercher un modÃ¨le",required:!0,disabled:!u,onKeyDown:t=>{if(t.key==="Enter")return t.preventDefault(),!1}}),it&&u&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[l.getState().settings.models.filter(t=>t.brandId===u&&t.name.toLowerCase().includes(N.toLowerCase())).map(t=>e.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{I(t.name),K(!1)},children:t.name},t.id)),N&&!l.getState().settings.models.some(t=>t.brandId===u&&t.name.toLowerCase()===N.toLowerCase())&&e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{await Nt(N,u),K(!1)},children:['Add "',N,'"']})]})]})]}),o===p.SUPER_ADMIN&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Assigner Ã  un technicien"}),e.jsxs("select",{value:ae,onChange:t=>ne(t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Non assignÃ©"}),Me.map(t=>e.jsx("option",{value:t.id,children:t.fullName},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"TÃ¢ches"}),e.jsxs("div",{className:`text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:["CoÃ»t total: â‚¬",qe.toFixed(2)]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:M,onChange:t=>{Ne(t.target.value),Q(t.target.value.length>0)},onBlur:()=>{setTimeout(()=>Q(!1),200)},placeholder:"Commencez Ã  taper pour rechercher une tÃ¢che",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onKeyDown:t=>{if(t.key==="Enter")return t.preventDefault(),!1}}),ot&&M&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[l.getState().settings.tasks.filter(t=>t.toLowerCase().includes(M.toLowerCase())).slice(0,5).map(t=>e.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{Oe(t),Ne(""),Q(!1)},children:t},t)),M&&!l.getState().settings.tasks.some(t=>t.toLowerCase()===M.toLowerCase())&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{const t=M,s=_e,r=[...h,{name:t,price:s}];sessionStorage.setItem("ticketTasksWithPrice",JSON.stringify(r)),T(r),P(!0);const{addTask:i}=l.getState();try{await i(t)}catch(c){console.error("Error adding task:",c)}Ne(""),Fe(0),Q(!1)},children:['Add "',M,'"']}),e.jsxs("div",{className:"px-4 py-2 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"Price:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:"â‚¬"}),e.jsx("input",{type:"number",value:_e,onChange:t=>Fe(Number(t.target.value)),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onClick:t=>t.stopPropagation()})]})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:`text-sm font-medium mb-2 ${n?"text-gray-300":"text-gray-700"}`,children:"TÃ¢ches populaires"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Array.from(l.getState().tickets.flatMap(t=>t.tasks).reduce((t,s)=>(t.set(s,(t.get(s)||0)+1),t),new Map).entries()).sort((t,s)=>s[1]-t[1]).slice(0,6).map(([t])=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:h.some(s=>s.name===t),onChange:()=>{P(!0),h.some(r=>r.name===t)?T(r=>r.filter(i=>i.name!==t)):Oe(t)},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:n?"text-gray-300":"text-gray-700",children:t})]},t))})]}),h.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:`text-sm font-medium mb-2 ${n?"text-gray-300":"text-gray-700"}`,children:"TÃ¢ches sÃ©lectionnÃ©es"}),e.jsx("div",{className:"space-y-2 border rounded-md p-3",children:h.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{type:"button",onClick:()=>xt(t.name),className:"mr-2 text-red-500 hover:text-red-700",children:"Supprimer"}),e.jsx("span",{className:n?"text-gray-300":"text-gray-700",children:t.name})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:"â‚¬"}),e.jsx("input",{type:"number",value:t.price,onChange:s=>gt(t.name,Number(s.target.value)),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]})]},t.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Code de dÃ©verrouillage (optionnel)"}),e.jsx("input",{type:"text",value:Z,onChange:t=>ee(t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"IMEI / NumÃ©ro de SÃ©rie (optionnel)"}),e.jsx("input",{type:"text",value:te,onChange:t=>ve(t.target.value),placeholder:"Entrez l'IMEI ou le numÃ©ro de sÃ©rie",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Description du problÃ¨me (optionnel)"}),e.jsx("textarea",{value:X,onChange:t=>Y(t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),m&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Statut"}),e.jsxs("select",{value:se,onChange:t=>re(t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"in-progress",children:"En cours"}),e.jsx("option",{value:"completed",children:"TerminÃ©"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Statut du paiement"}),e.jsxs("select",{value:q,onChange:t=>O(t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"not_paid",children:"Non payÃ©"}),e.jsx("option",{value:"partially_paid",children:"Partiellement payÃ©"}),e.jsx("option",{value:"fully_paid",children:"PayÃ©"})]})]}),q==="partially_paid"&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Montant payÃ© (â‚¬)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:ie,onChange:t=>H(parseFloat(t.target.value)||0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"0.00"})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{Ie(!1),he(null),U(""),L(""),z(""),B(""),I(""),T([]),Y(""),ee(""),re("pending"),ne(""),O("not_paid"),H(0),P(!1)},className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:k,children:"Annuler"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",disabled:k,children:k?m?"Mise Ã  jour...":"CrÃ©ation...":m?"Mettre Ã  jour le ticket":"CrÃ©er le ticket"})]})]})]})}),D==="all"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 space-y-4 sm:space-y-0 sm:flex sm:items-center sm:gap-4",children:[e.jsxs("select",{value:oe,onChange:t=>lt(t.target.value),className:"w-full sm:w-40 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"Tout rechercher"}),e.jsx("option",{value:"ticket",children:"NumÃ©ro de ticket"}),e.jsx("option",{value:"client",children:"Informations client"}),e.jsx("option",{value:"tasks",children:"TÃ¢ches"})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-4 bg-white dark:bg-gray-700 p-4 rounded-lg shadow-inner",children:[e.jsx(Et,{className:"h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:`Rechercher des ${oe==="all"?"tickets":oe}...`,value:we,onChange:t=>st(t.target.value),className:"flex-1 bg-transparent border-0 focus:ring-0 text-gray-900 dark:text-white placeholder-gray-400"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:S,onChange:t=>G(t.target.value),className:"rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"Tous les statuts"}),e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"in-progress",children:"En cours"}),e.jsx("option",{value:"completed",children:"TerminÃ©"})]}),e.jsxs("button",{onClick:()=>dt(t=>t==="asc"?"desc":"asc"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",title:"Trier par date",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:Re==="asc"?"Plus ancien d'abord":"Plus rÃ©cent d'abord"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:n?"bg-gray-700":"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Ticket #"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Appareil"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"TÃ¢ches"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"CoÃ»t"}),o===p.SUPER_ADMIN&&e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Technicien"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider min-w-[120px] w-[180px] sm:w-[160px] md:w-[180px]",children:"Paiement"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider min-w-[120px]",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y divide-gray-200 dark:divide-gray-700 ${n?"bg-gray-800":"bg-white"}`,children:ze.length>0?ze.map(t=>{const s=b.find(i=>i.id===t.clientId),r=t.taskPrices?t.taskPrices.map(i=>`${i.name} (â‚¬${i.price})`).join(", "):t.tasks.join(", ");return e.jsxs("tr",{className:`hover:${n?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:["#",t.ticketNumber]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(At,{className:"h-4 w-4 mr-2 text-gray-400"}),(s==null?void 0:s.name)||"Unknown Client"]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:[t.deviceType," - ",t.brand]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300 max-w-xs truncate",children:r}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["â‚¬",t.cost]}),o===p.SUPER_ADMIN&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.technicianId?bt(t.technicianId):"Unassigned"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:Ve(t)?e.jsxs("select",{value:t.status,onChange:i=>g(t.id,{status:i.target.value}),className:"text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"in-progress",children:"En cours"}),e.jsx("option",{value:"completed",children:"TerminÃ©"})]}):jt(t.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:vt(t.paymentStatus||"not_paid")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"h-4 w-4 mr-2 text-gray-400"}),t.createdAt?Qe(new Date(t.createdAt),"MMM d, yyyy"):"Unknown"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:e.jsxs("div",{className:"flex justify-center space-x-3",children:[Ve(t)&&e.jsx("button",{onClick:()=>{he(t.id),ce("create")},className:"text-blue-600 hover:text-blue-800",title:"Edit",children:e.jsx(Pt,{className:"h-5 w-5"})}),t.paymentStatus==="fully_paid"&&!t.invoiceGenerated&&e.jsx("button",{onClick:()=>ft(t),className:"text-blue-600 hover:text-blue-800",title:"GÃ©nÃ©rer Facture",children:e.jsx($t,{className:"h-5 w-5"})}),t.invoiceGenerated&&t.invoiceId&&e.jsx("button",{onClick:()=>He(t.invoiceId),className:"text-green-600 hover:text-green-800",title:"Voir Facture",children:e.jsx(Lt,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{Le(t.ticketNumber),L(t.clientId),pe(!0)},className:"text-indigo-600 hover:text-indigo-800",title:"Generate Document",children:e.jsx(me,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{if(!b.find(c=>c.id===t.clientId)){alert("Client information not found for this ticket.");return}Ee(t),L(t.clientId),Te(!0)},className:"text-purple-600 hover:text-purple-800",title:"GÃ©nÃ©rer Contrat d'Engagement",children:e.jsx(Mt,{className:"h-5 w-5"})}),o===p.SUPER_ADMIN&&e.jsx("button",{onClick:()=>pt(t.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx(Ke,{className:"h-5 w-5"})})]})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:o===p.SUPER_ADMIN?9:8,className:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:o===p.TECHNICIAN?"No tickets assigned to you yet":"No tickets found"})})})]})})]})}),D==="invoices"&&e.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:`text-xl font-semibold ${n?"text-white":"text-gray-900"}`,children:"Toutes les factures de rÃ©paration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>mt(t=>t==="asc"?"desc":"asc"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",title:"Trier par date",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:Ue==="asc"?"Plus ancien d'abord":"Plus rÃ©cent d'abord"})]}),e.jsx("button",{onClick:()=>{setTimeout(()=>{},500)},className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700",children:"Actualiser"})]})]}),e.jsx("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:"ðŸ’¡"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:`text-sm font-medium ${n?"text-blue-200":"text-blue-800"}`,children:"Comment gÃ©nÃ©rer des factures"}),e.jsx("div",{className:`mt-2 text-sm ${n?"text-blue-300":"text-blue-700"}`,children:e.jsx("p",{children:`Les factures sont gÃ©nÃ©rÃ©es automatiquement Ã  partir des tickets de rÃ©paration payÃ©s intÃ©gralement. Allez dans l'onglet "Tous les tickets", trouvez un ticket avec le statut "PayÃ©" et cliquez sur le bouton ðŸ’° pour gÃ©nÃ©rer sa facture.`})})]})]})}),_.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:`text-lg ${n?"text-gray-400":"text-gray-500"}`,children:"Aucune facture gÃ©nÃ©rÃ©e"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Les factures apparaÃ®tront ici une fois gÃ©nÃ©rÃ©es Ã  partir des tickets payÃ©s"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:n?"bg-gray-700":"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Facture #"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Ticket #"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Appareil"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y divide-gray-200 dark:divide-gray-700 ${n?"bg-gray-800":"bg-white"}`,children:_.sort((t,s)=>{const r=new Date(t.date).getTime(),i=new Date(s.date).getTime();return Ue==="asc"?r-i:i-r}).map(t=>{A.find(r=>r.id===t.ticketId);const s=b.find(r=>r.id===t.clientId);return e.jsxs("tr",{className:`hover:${n?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.invoiceNumber}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["#",t.ticketNumber]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:(s==null?void 0:s.name)||"Client inconnu"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.deviceType&&t.brand?`${t.deviceType} - ${t.brand}${t.model?` ${t.model}`:""}`:"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"PayÃ©"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:["â‚¬",t.total.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"h-4 w-4 mr-2 text-gray-400"}),Qe(new Date(t.date),"MMM d, yyyy")]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>He(t.id),className:"text-indigo-600 hover:text-indigo-800",title:"Voir la facture",children:e.jsx(me,{className:"h-5 w-5"})}),o===p.SUPER_ADMIN&&t.id&&e.jsx("button",{onClick:()=>yt(t.id),className:"text-red-600 hover:text-red-800",title:"Supprimer la facture",children:e.jsx(Ke,{className:"h-5 w-5"})})]})})]},t.id)})})]})})]}),Ze&&$e&&e.jsx(ke,{data:Ct(A.find(t=>t.ticketNumber===$e),$,b.find(t=>t.id===$)),onClose:()=>pe(!1),initialFormat:"a4"}),tt&&Ae&&e.jsx(ke,{data:Ae,onClose:()=>{De(!1),Pe(null)},initialFormat:"a4"}),et&&ye&&e.jsx(ke,{data:It(ye,b.find(t=>t.id===ye.clientId)),onClose:()=>{Te(!1),Ee(null)},initialFormat:"a4"})]})}export{Vt as default};
