import{j as e}from"./vendor-pdf-renderer-D4KtQ5U9.js";import{r as i}from"./vendor-react-NkhADs9z.js";import{u as k,d as S,k as C,m as $,n as D,o as E}from"./index-EHYfLQ4V.js";import{n as U,d as q}from"./vendor-firebase-CWMDWzYz.js";import{K as A,y as F,h as M,O as R,k as T,N as p}from"./vendor-ui-hUul1yDo.js";import"./vendor-utils-BK9ZHHVQ.js";import"./vendor-pdf-utils-CBrSDip1.js";function G(){const o=k(s=>s.isDarkMode),{user:d,userRole:w}=S(),[n,f]=i.useState({fullName:(d==null?void 0:d.displayName)||"",email:(d==null?void 0:d.email)||"",phone:"",role:w||"technician"}),[r,x]=i.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[c,l]=i.useState(!1),[b,t]=i.useState(""),[y,m]=i.useState(""),[u,g]=i.useState("profile");i.useEffect(()=>{(async()=>{if(d)try{const a=await U(q(C,"users",d.uid));if(a.exists()){const h=a.data();f(P=>({...P,fullName:h.fullName||d.displayName||"",phone:h.phoneNumber||"",role:h.role||"technician"}))}}catch(a){console.error("Error fetching user profile:",a)}})()},[d]);const v=async s=>{s.preventDefault(),t(""),m(""),l(!0);try{const a=await $(n.fullName,n.phone);a.success?m("Profile updated successfully"):t(a.error||"Failed to update profile")}catch(a){t(a.message||"An unexpected error occurred")}finally{l(!1)}},j=async s=>{s.preventDefault(),t(""),m(""),l(!0);try{if(!r.currentPassword){t("Current password is required to change email"),l(!1);return}const a=await D(n.email,r.currentPassword);a.success?m("Email updated successfully"):t(a.error||"Failed to update email")}catch(a){t(a.message||"An unexpected error occurred")}finally{l(!1)}},N=async s=>{if(s.preventDefault(),t(""),m(""),r.newPassword!==r.confirmPassword){t("New passwords do not match");return}l(!0);try{const a=await E(r.currentPassword,r.newPassword);a.success?(m("Password updated successfully"),x({currentPassword:"",newPassword:"",confirmPassword:""})):t(a.error||"Failed to update password")}catch(a){t(a.message||"An unexpected error occurred")}finally{l(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:`text-2xl font-semibold ${o?"text-white":"text-gray-900"}`,children:"Account Settings"}),e.jsxs("div",{className:`rounded-lg ${o?"bg-gray-800":"bg-white"} shadow`,children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>g("profile"),className:`py-4 px-6 font-medium text-sm border-b-2 ${u==="profile"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Profile"}),e.jsx("button",{onClick:()=>g("email"),className:`py-4 px-6 font-medium text-sm border-b-2 ${u==="email"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Email"}),e.jsx("button",{onClick:()=>g("password"),className:`py-4 px-6 font-medium text-sm border-b-2 ${u==="password"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Password"})]})}),e.jsxs("div",{className:"p-6",children:[b&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded flex items-center",children:[e.jsx(A,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:b})]}),y&&e.jsxs("div",{className:"mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded flex items-center",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:y})]}),u==="profile"&&e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"Full Name"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(M,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:n.fullName,onChange:s=>f({...n,fullName:s.target.value}),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"Phone Number"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(R,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"tel",value:n.phone,onChange:s=>f({...n,phone:s.target.value}),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"Role"}),e.jsx("input",{type:"text",value:n.role,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-gray-100 rounded-md shadow-sm text-gray-700 cursor-not-allowed",disabled:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Your role cannot be changed. Contact an administrator for role changes."})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:c,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:c?"Saving...":"Save Changes"})})]}),u==="email"&&e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"Email Address"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(T,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"email",value:n.email,onChange:s=>f({...n,email:s.target.value}),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"Current Password (required to change email)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(p,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",value:r.currentPassword,onChange:s=>x({...r,currentPassword:s.target.value}),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:c,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:c?"Updating...":"Update Email"})})]}),u==="password"&&e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"Current Password"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(p,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",value:r.currentPassword,onChange:s=>x({...r,currentPassword:s.target.value}),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"New Password"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(p,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",value:r.newPassword,onChange:s=>x({...r,newPassword:s.target.value}),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"Confirm New Password"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(p,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",value:r.confirmPassword,onChange:s=>x({...r,confirmPassword:s.target.value}),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),r.confirmPassword&&r.newPassword!==r.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Passwords do not match"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:c||r.newPassword!==r.confirmPassword,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:c?"Updating...":"Update Password"})})]})]})]})]})}export{G as default};
