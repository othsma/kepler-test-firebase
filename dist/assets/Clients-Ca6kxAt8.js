import{j as e}from"./vendor-pdf-renderer-D4KtQ5U9.js";import{r as d}from"./vendor-react-NkhADs9z.js";import{u as P,b as q,a as H,e as F,f as O}from"./index-DJIaQBgV.js";import{p as I,m as Q,o as R,H as V,E as z,T as B}from"./vendor-ui-hUul1yDo.js";import{f as g}from"./vendor-utils-BK9ZHHVQ.js";import"./vendor-firebase-CWMDWzYz.js";import"./vendor-pdf-utils-CBrSDip1.js";function Z(){const t=P(s=>s.isDarkMode),{clients:h,addClient:p,updateClient:b,deleteClient:N,loading:f,error:j}=q(),{tickets:w}=H(),{orders:v}=F(),{sales:$}=O(),[C,u]=d.useState(!1),[c,y]=d.useState(null),[S,k]=d.useState(null),[r,n]=d.useState({name:"",email:"",phone:"",address:""}),[m,M]=d.useState(""),A=d.useMemo(()=>{if(!m.trim())return h;const s=m.toLowerCase();return h.filter(i=>i.name.toLowerCase().includes(s)||i.email.toLowerCase().includes(s)||i.phone.toLowerCase().includes(s)||i.address.toLowerCase().includes(s))},[h,m]),D=async s=>{s.preventDefault(),c?(await b(c,r),y(null)):(await p(r),u(!1)),n({name:"",email:"",phone:"",address:""})},T=s=>{const i=w.filter(l=>l.clientId===s),x=v.filter(l=>l.clientId===s),o=$.filter(l=>{var a;return((a=l.customer)==null?void 0:a.id)===s});return{tickets:i,orders:x,sales:o}},L=async s=>{window.confirm("Êtes-vous sûr de vouloir supprimer ce client ?")&&await N(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:`text-2xl font-semibold ${t?"text-white":"text-gray-900"}`,children:"Clients"}),e.jsxs("button",{onClick:()=>u(!0),className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Ajouter un client"]})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx(Q,{className:"h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher des clients...",value:m,onChange:s=>M(s.target.value),className:"flex-1 bg-transparent border-0 focus:ring-0 text-gray-900 dark:text-white placeholder-gray-400"})]}),f&&e.jsx("div",{className:`rounded-lg ${t?"bg-gray-800":"bg-white"} shadow p-6 text-center`,children:e.jsx("p",{className:t?"text-white":"text-gray-900",children:"Chargement des clients..."})}),j&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[e.jsx("strong",{className:"font-bold",children:"Error!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",j]})]}),(C||c)&&e.jsxs("div",{className:`rounded-lg ${t?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsx("h2",{className:`text-lg font-semibold mb-4 ${t?"text-white":"text-gray-900"}`,children:c?"Modifier le client":"Ajouter un nouveau client"}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Nom"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>n({...r,name:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Email"}),e.jsx("input",{type:"email",value:r.email,onChange:s=>n({...r,email:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Phone"}),e.jsx("input",{type:"tel",value:r.phone,onChange:s=>n({...r,phone:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Adresse"}),e.jsx("textarea",{value:r.address,onChange:s=>n({...r,address:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{u(!1),y(null),n({name:"",email:"",phone:"",address:""})},className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Annuler"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700",children:c?"Mettre à jour":"Ajouter"})]})]})]}),e.jsx("div",{className:"grid gap-6",children:A.map(s=>{const{tickets:i,orders:x,sales:o}=T(s.id),l=S===s.id;return e.jsxs("div",{className:`rounded-lg ${t?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:`text-lg font-semibold ${t?"text-white":"text-gray-900"}`,children:s.name}),e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["ID: ",s.id]})]}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:s.email}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:s.phone}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:s.address}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(R,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Membre depuis: ",g(new Date(s.createdAt),"MMM d, yyyy")]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{k(l?null:s.id)},className:`p-2 rounded-full ${l?"bg-indigo-100 text-indigo-600":"text-gray-400 hover:text-gray-500"}`,children:e.jsx(V,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{y(s.id),n({name:s.name,email:s.email,phone:s.phone,address:s.address})},className:"p-2 text-gray-400 hover:text-gray-500",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>L(s.id),className:"p-2 text-gray-400 hover:text-red-500",children:e.jsx(B,{className:"h-5 w-5"})})]})]}),l&&e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h4",{className:`font-semibold ${t?"text-white":"text-gray-900"}`,children:"Historique du client"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:`text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Tickets de réparation"}),e.jsx("div",{className:"space-y-2",children:i.length>0?i.map(a=>e.jsxs("div",{className:`p-3 rounded-md ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:t?"text-white":"text-gray-900",children:[a.deviceType," - ",a.brand]}),e.jsxs("span",{className:`text-sm ${t?"text-gray-300":"text-gray-600"}`,children:["€",a.cost]})]}),e.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Tâches: ",a.tasks.join(", ")]}),a.issue&&e.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Problème: ",a.issue]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Statut: ",a.status]}),e.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:g(new Date(a.createdAt),"MMM d, yyyy")})]})]},a.id)):e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"Aucun ticket de réparation pour le moment"})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:`text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Historique d'achat"}),e.jsx("div",{className:"space-y-2",children:x.length>0||o.length>0?e.jsxs(e.Fragment,{children:[x.map(a=>e.jsxs("div",{className:`p-3 rounded-md ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:t?"text-white":"text-gray-900",children:["Commande #",a.id]}),e.jsxs("span",{className:`text-sm ${t?"text-gray-300":"text-gray-600"}`,children:["€",a.total]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Type: Commande • Statut: ",a.status]}),e.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:g(new Date(a.createdAt),"MMM d, yyyy")})]})]},`order-${a.id}`)),o.map(a=>e.jsxs("div",{className:`p-3 rounded-md ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:t?"text-white":"text-gray-900",children:["Facture ",a.invoiceNumber]}),e.jsxs("span",{className:`text-sm ${t?"text-gray-300":"text-gray-600"}`,children:["€",a.total.toFixed(2)]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:[a.items.length," article(s): ",a.items.slice(0,2).map(E=>E.name).join(", "),a.items.length>2?"...":""]})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Type: Vente PDV • Paiement: ",a.paymentMethod]}),e.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:g(new Date(a.date),"MMM d, yyyy")})]})]},`sale-${a.id}`))]}):e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"Aucun historique d'achat pour le moment"})})]})]})]})]},s.id)})})]})}export{Z as default};
