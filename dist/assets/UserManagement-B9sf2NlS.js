import{j as e}from"./vendor-pdf-renderer-DJMoKmcy.js";import{r as l}from"./vendor-react-DSd34EeT.js";import{u as k,d as S,R as c,o as j,t as C}from"./index-DjdW4VBb.js";import{k as A,l as E,n as R,d as U}from"./vendor-firebase-CWMDWzYz.js";import{V as D,y as $,m as L,h as M}from"./vendor-ui-CfnjVJp_.js";import"./vendor-utils-CWf8nFur.js";import"./vendor-pdf-utils-CBrSDip1.js";function G(){const t=k(s=>s.isDarkMode),{userRole:o}=S(),[N,h]=l.useState([]),[b,u]=l.useState(!0),[p,i]=l.useState(""),[g,y]=l.useState(""),[x,v]=l.useState("");l.useEffect(()=>{(async()=>{if(o!==c.SUPER_ADMIN){i("Vous n'avez pas la permission d'accéder à cette page"),u(!1);return}try{const r=A(j,"users"),d=(await E(r)).docs.map(n=>({id:n.id,...n.data()}));h(d)}catch(r){console.error("Error fetching users:",r),i("Échec du chargement des utilisateurs")}finally{u(!1)}})()},[o]);const w=async(s,r)=>{try{i(""),y("");const a=await R(U(j,"users",s));if(a.exists()&&a.data().email==="othsma@gmail.com"){i("Impossible de changer le rôle du super administrateur");return}const d=await C(s,r);d.success?(h(n=>n.map(m=>m.id===s?{...m,role:r}:m)),y("Rôle de l'utilisateur mis à jour avec succès")):i(d.error||"Échec de la mise à jour du rôle utilisateur")}catch(a){i(a.message||"Une erreur inattendue s'est produite")}},f=N.filter(s=>{var r,a;return((r=s.fullName)==null?void 0:r.toLowerCase().includes(x.toLowerCase()))||((a=s.email)==null?void 0:a.toLowerCase().includes(x.toLowerCase()))});return o!==c.SUPER_ADMIN?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:`text-xl font-semibold mb-2 ${t?"text-white":"text-gray-900"}`,children:"Accès refusé"}),e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:"Vous n'avez pas la permission d'accéder à cette page."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:`text-2xl font-semibold ${t?"text-white":"text-gray-900"}`,children:"Gestion des utilisateurs"}),p&&e.jsxs("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded flex items-center",children:[e.jsx(D,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:p})]}),g&&e.jsxs("div",{className:"p-3 bg-green-100 border border-green-400 text-green-700 rounded flex items-center",children:[e.jsx($,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:g})]}),e.jsxs("div",{className:`rounded-lg ${t?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsx("div",{className:"flex items-center mb-6",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3  flex items-center pointer-events-none",children:e.jsx(L,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Rechercher des utilisateurs...",value:x,onChange:s=>v(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]})}),b?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"}),e.jsx("p",{className:`mt-4 ${t?"text-gray-300":"text-gray-600"}`,children:"Chargement des utilisateurs..."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:t?"bg-gray-700":"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Nom"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Téléphone"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Rôle"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y divide-gray-200 dark:divide-gray-700 ${t?"bg-gray-800":"bg-white"}`,children:f.length>0?f.map(s=>e.jsxs("tr",{className:`hover:${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx(M,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:`font-medium ${t?"text-white":"text-gray-900"}`,children:s.fullName}),e.jsxs("div",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["ID utilisateur: ",s.id.substring(0,8),"..."]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:t?"text-gray-300":"text-gray-500",children:s.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:t?"text-gray-300":"text-gray-500",children:s.phoneNumber||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.role===c.SUPER_ADMIN?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"}`,children:s.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.email==="othsma@gmail.com"?e.jsx("span",{className:"text-sm text-gray-500",children:"Super Admin (verrouillé)"}):e.jsxs("select",{value:s.role,onChange:r=>w(s.id,r.target.value),className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e.jsx("option",{value:c.TECHNICIAN,children:"Technicien"}),e.jsx("option",{value:c.SUPER_ADMIN,children:"Super Admin"})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:"Aucun utilisateur trouvé"})})})]})})]})]})}export{G as default};
