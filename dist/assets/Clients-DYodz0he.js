import{j as e}from"./vendor-pdf-renderer-Bq4DoPCL.js";import{r as c}from"./vendor-react-NkhADs9z.js";import{u as O,b as P,a as H,e as I,f as F}from"./index-BdcVSwpg.js";import{p as q,m as Q,o as R,H as U,E as z,T as B}from"./vendor-ui-hUul1yDo.js";import{f as g}from"./vendor-utils-BK9ZHHVQ.js";import"./vendor-firebase-CWMDWzYz.js";import"./vendor-pdf-utils-BfYXEYrK.js";function Z(){const t=O(s=>s.isDarkMode),{clients:h,searchQuery:m,setSearchQuery:j,addClient:N,updateClient:b,deleteClient:f,loading:w,error:p}=P(),{tickets:v}=H(),{orders:$}=I(),{sales:C}=F(),[S,y]=c.useState(!1),[n,u]=c.useState(null),[k,M]=c.useState(null),[r,l]=c.useState({name:"",email:"",phone:"",address:""}),D=c.useMemo(()=>{if(!m.trim())return h;const s=m.toLowerCase();return h.filter(i=>i.name.toLowerCase().includes(s)||i.email.toLowerCase().includes(s)||i.phone.toLowerCase().includes(s)||i.address.toLowerCase().includes(s))},[h,m]),T=async s=>{s.preventDefault(),n?(await b(n,r),u(null)):(await N(r),y(!1)),l({name:"",email:"",phone:"",address:""})},A=s=>{const i=v.filter(d=>d.clientId===s),x=$.filter(d=>d.clientId===s),o=C.filter(d=>{var a;return((a=d.customer)==null?void 0:a.id)===s});return{tickets:i,orders:x,sales:o}},E=async s=>{window.confirm("Are you sure you want to delete this client?")&&await f(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:`text-2xl font-semibold ${t?"text-white":"text-gray-900"}`,children:"Clients"}),e.jsxs("button",{onClick:()=>y(!0),className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Add Client"]})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx(Q,{className:"h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search clients...",value:m,onChange:s=>j(s.target.value),className:"flex-1 bg-transparent border-0 focus:ring-0 text-gray-900 dark:text-white placeholder-gray-400"})]}),w&&e.jsx("div",{className:`rounded-lg ${t?"bg-gray-800":"bg-white"} shadow p-6 text-center`,children:e.jsx("p",{className:t?"text-white":"text-gray-900",children:"Loading clients..."})}),p&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[e.jsx("strong",{className:"font-bold",children:"Error!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",p]})]}),(S||n)&&e.jsxs("div",{className:`rounded-lg ${t?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsx("h2",{className:`text-lg font-semibold mb-4 ${t?"text-white":"text-gray-900"}`,children:n?"Edit Client":"Add New Client"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Name"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>l({...r,name:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Email"}),e.jsx("input",{type:"email",value:r.email,onChange:s=>l({...r,email:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Phone"}),e.jsx("input",{type:"tel",value:r.phone,onChange:s=>l({...r,phone:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Address"}),e.jsx("textarea",{value:r.address,onChange:s=>l({...r,address:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{y(!1),u(null),l({name:"",email:"",phone:"",address:""})},className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700",children:n?"Update":"Add"})]})]})]}),e.jsx("div",{className:"grid gap-6",children:D.map(s=>{const{tickets:i,orders:x,sales:o}=A(s.id),d=k===s.id;return e.jsxs("div",{className:`rounded-lg ${t?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:`text-lg font-semibold ${t?"text-white":"text-gray-900"}`,children:s.name}),e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["ID: ",s.id]})]}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:s.email}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:s.phone}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:s.address}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(R,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Member since: ",g(new Date(s.createdAt),"MMM d, yyyy")]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{M(d?null:s.id)},className:`p-2 rounded-full ${d?"bg-indigo-100 text-indigo-600":"text-gray-400 hover:text-gray-500"}`,children:e.jsx(U,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{u(s.id),l({name:s.name,email:s.email,phone:s.phone,address:s.address})},className:"p-2 text-gray-400 hover:text-gray-500",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>E(s.id),className:"p-2 text-gray-400 hover:text-red-500",children:e.jsx(B,{className:"h-5 w-5"})})]})]}),d&&e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h4",{className:`font-semibold ${t?"text-white":"text-gray-900"}`,children:"Client History"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:`text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Repair Tickets"}),e.jsx("div",{className:"space-y-2",children:i.length>0?i.map(a=>e.jsxs("div",{className:`p-3 rounded-md ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:t?"text-white":"text-gray-900",children:[a.deviceType," - ",a.brand]}),e.jsxs("span",{className:`text-sm ${t?"text-gray-300":"text-gray-600"}`,children:["$",a.cost]})]}),e.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Tasks: ",a.tasks.join(", ")]}),a.issue&&e.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Issue: ",a.issue]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Status: ",a.status]}),e.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:g(new Date(a.createdAt),"MMM d, yyyy")})]})]},a.id)):e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"No repair tickets yet"})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:`text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Purchase History"}),e.jsx("div",{className:"space-y-2",children:x.length>0||o.length>0?e.jsxs(e.Fragment,{children:[x.map(a=>e.jsxs("div",{className:`p-3 rounded-md ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:t?"text-white":"text-gray-900",children:["Order #",a.id]}),e.jsxs("span",{className:`text-sm ${t?"text-gray-300":"text-gray-600"}`,children:["$",a.total]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Type: Order • Status: ",a.status]}),e.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:g(new Date(a.createdAt),"MMM d, yyyy")})]})]},`order-${a.id}`)),o.map(a=>e.jsxs("div",{className:`p-3 rounded-md ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:t?"text-white":"text-gray-900",children:["Invoice ",a.invoiceNumber]}),e.jsxs("span",{className:`text-sm ${t?"text-gray-300":"text-gray-600"}`,children:["€",a.total.toFixed(2)]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:[a.items.length," item(s): ",a.items.slice(0,2).map(L=>L.name).join(", "),a.items.length>2?"...":""]})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["Type: POS Sale • Payment: ",a.paymentMethod]}),e.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:g(new Date(a.date),"MMM d, yyyy")})]})]},`sale-${a.id}`))]}):e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"No purchase history yet"})})]})]})]})]},s.id)})})]})}export{Z as default};
