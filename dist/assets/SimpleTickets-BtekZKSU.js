import{j as t}from"./vendor-pdf-renderer-Bq4DoPCL.js";import{r as a}from"./vendor-react-NkhADs9z.js";import{u as Le,b as Ee,a as c,d as tt,R as h,U as Ie,g as De,h as st}from"./index-C3Sobv5p.js";import{m as at,o as Ae,I as rt,h as nt,J as it,l as ot,F as dt,T as lt}from"./vendor-ui-hUul1yDo.js";import{f as ct}from"./vendor-utils-BK9ZHHVQ.js";import"./vendor-firebase-CWMDWzYz.js";import"./vendor-pdf-utils-BfYXEYrK.js";function mt({onSubmit:n,onCancel:v}){const f=Le(o=>o.isDarkMode),{addClient:W,loading:b}=Ee(),[u,w]=a.useState({name:"",email:"",phone:"",address:""}),Q=async o=>{o.preventDefault();const y=await W(u);y?n(y):console.error("Failed to create client")};return t.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${f?"text-gray-300":"text-gray-700"}`,children:"Name"}),t.jsx("input",{type:"text",value:u.name,onChange:o=>w({...u,name:o.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${f?"text-gray-300":"text-gray-700"}`,children:"Email (Optional)"}),t.jsx("input",{type:"email",value:u.email,onChange:o=>w({...u,email:o.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${f?"text-gray-300":"text-gray-700"}`,children:"Phone"}),t.jsx("input",{type:"tel",value:u.phone,onChange:o=>w({...u,phone:o.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${f?"text-gray-300":"text-gray-700"}`,children:"Address (Optional)"}),t.jsx("textarea",{value:u.address,onChange:o=>w({...u,address:o.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),t.jsxs("div",{className:"flex justify-end gap-4",children:[t.jsx("button",{type:"button",onClick:v,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:b,children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",disabled:b,children:b?"Creating...":"Create Client"})]})]})}function jt(){const n=Le(e=>e.isDarkMode),{tickets:v,updateTicket:f,deleteTicket:W,loading:b,error:u,filterStatus:w,setFilterStatus:Q}=c(),{clients:o}=Ee(),{user:y,userRole:m}=tt(),[ut,D]=a.useState(()=>{try{return JSON.parse(sessionStorage.getItem("ticketFormStarted")||"false")}catch{return!1}}),[xt,ce]=a.useState(!1),[l,V]=a.useState(null),[G,L]=a.useState(""),[k,C]=a.useState(""),[Fe,X]=a.useState(!1),[$e,me]=a.useState(!1),[F,$]=a.useState(""),[Y,Z]=a.useState(!1),[ee,_e]=a.useState(""),[ue,Me]=a.useState([]),[Ue,_]=a.useState(!1),[Re,M]=a.useState(!1),[Be,U]=a.useState(!1),[Oe,R]=a.useState(!1),[qe,te]=a.useState(!1),[S,B]=a.useState(()=>{try{return sessionStorage.getItem("ticketDeviceType")||""}catch{return""}}),[x,O]=a.useState(()=>{try{return sessionStorage.getItem("ticketBrand")||""}catch{return""}}),[T,P]=a.useState(()=>{try{return sessionStorage.getItem("ticketModel")||""}catch{return""}}),[p,I]=a.useState(()=>{try{const e=sessionStorage.getItem("ticketTasksWithPrice");return e?JSON.parse(e):[]}catch{return[]}}),[xe,se]=a.useState(()=>{try{return sessionStorage.getItem("ticketIssue")||""}catch{return""}}),[ge,ae]=a.useState(()=>{try{return sessionStorage.getItem("ticketPasscode")||""}catch{return""}}),[he,re]=a.useState(()=>{try{return sessionStorage.getItem("ticketStatus")||"pending"}catch{return"pending"}}),[pe,ne]=a.useState(()=>{try{return sessionStorage.getItem("ticketTechnicianId")||""}catch{return""}}),[ie,q]=a.useState(()=>{try{return sessionStorage.getItem("ticketPaymentStatus")||"not_paid"}catch{return"not_paid"}}),[ye,z]=a.useState(()=>{try{return parseFloat(sessionStorage.getItem("ticketAmountPaid")||"0")}catch{return 0}}),[A,oe]=a.useState(""),[fe,be]=a.useState(0),[we,ze]=a.useState("desc"),[H,He]=a.useState("all"),[K,de]=a.useState("create");a.useEffect(()=>{(async()=>{try{if(m===h.SUPER_ADMIN){const s=await st();Me(s||[])}}catch(s){console.error("Error fetching technicians:",s)}})()},[m]),a.useEffect(()=>{if(l){const e=v.find(s=>s.id===l);e&&(B(e.deviceType||""),O(e.brand||""),P(e.model||""),se(e.issue||""),ae(e.passcode||""),z(e.amountPaid||0),I(e.taskPrices||e.tasks.map(s=>({name:s,price:e.cost/(e.tasks.length||1)}))),re(e.status||"pending"),ne(e.technicianId||""),q(e.paymentStatus||"not_paid"))}},[l]);const je=v.filter(e=>{var s,r,i,j,N,J,Ce,Se,Te,Pe;if(m===h.TECHNICIAN&&y&&e.technicianId!==y.uid||w!=="all"&&e.status!==w)return!1;if(ee){const d=o.find(E=>E.id===e.clientId),g=ee.toLowerCase();switch(H){case"tasks":return e.tasks.some(E=>E.toLowerCase().includes(g));case"client":return((s=d==null?void 0:d.name)==null?void 0:s.toLowerCase().includes(g))||((r=d==null?void 0:d.email)==null?void 0:r.toLowerCase().includes(g))||((i=d==null?void 0:d.phone)==null?void 0:i.toLowerCase().includes(g));case"ticket":return(j=e.ticketNumber)==null?void 0:j.toLowerCase().includes(g);case"all":default:return((N=e.ticketNumber)==null?void 0:N.toLowerCase().includes(g))||((J=e.deviceType)==null?void 0:J.toLowerCase().includes(g))||((Ce=e.brand)==null?void 0:Ce.toLowerCase().includes(g))||((Se=d==null?void 0:d.name)==null?void 0:Se.toLowerCase().includes(g))||((Te=d==null?void 0:d.email)==null?void 0:Te.toLowerCase().includes(g))||((Pe=d==null?void 0:d.phone)==null?void 0:Pe.toLowerCase().includes(g))||e.tasks.some(E=>E.toLowerCase().includes(g))}}return!0}).sort((e,s)=>{const r=new Date(e.createdAt).getTime(),i=new Date(s.createdAt).getTime();return we==="asc"?r-i:i-r}),Ne=o.filter(e=>{var s,r;return((s=e.name)==null?void 0:s.toLowerCase().includes(G.toLowerCase()))||((r=e.email)==null?void 0:r.toLowerCase().includes(G.toLowerCase()))}),ve=p.reduce((e,s)=>e+(s.price||0),0),Ke=async e=>{var s;e.preventDefault();try{if(!k&&!l){alert("Please select a client");return}const r=p.map(N=>N.name),i=l?((s=v.find(N=>N.id===l))==null?void 0:s.clientId)||"":k;if(!i){alert("Client ID is required");return}const j={deviceType:S,brand:x,model:T,tasks:r,taskPrices:p,issue:xe,passcode:ge,status:he,cost:ve,technicianId:pe||"",clientId:i,paymentStatus:ie,amountPaid:ye};if(l)await f(l,j),V(null);else{const{addTicket:N}=c.getState(),J=await N(j);$(J),X(!0)}l||(ce(!1),L(""),C(""),B(""),O(""),P(""),I([]),se(""),ae(""),re("pending"),ne(""),q("not_paid"),z(0),D(!1)),l||(q("not_paid"),z(0))}catch(r){console.error("Error submitting ticket:",r),alert("An error occurred while saving the ticket. Please try again.")}},ke=e=>{e.trim()&&I([...p,{name:e.trim(),price:0}])},Je=e=>{I(p.filter(s=>s.name!==e))},We=(e,s)=>{I(p.map(r=>r.name===e?{...r,price:s}:r))},Qe=e=>{const s=o.find(r=>r.id===e);s&&(C(e),L(s.name)),Z(!1)},Ve=async e=>{if(window.confirm("Are you sure you want to delete this ticket?"))try{await W(e)}catch(s){console.error("Error deleting ticket:",s),alert("An error occurred while deleting the ticket.")}},Ge=e=>{const s=ue.find(r=>r.id===e);return s?s.fullName:"Unassigned"},Xe=async e=>{const{addDeviceType:s}=c.getState();await s(e)},le=e=>!!(m===h.SUPER_ADMIN||m===h.TECHNICIAN&&y&&e.technicianId===(y==null?void 0:y.uid)),Ye=e=>{switch(e){case"pending":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:"Pending"});case"in-progress":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:"In Progress"});case"completed":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"Completed"});default:return null}},Ze=e=>{switch(e){case"not_paid":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"Not Paid"});case"partially_paid":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:"Partially Paid"});case"fully_paid":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"Fully Paid"});default:return null}},et=async(e,s)=>{const{addModel:r}=c.getState();await r({name:e,brandId:s})};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex justify-between items-center",children:t.jsx("h1",{className:`text-2xl font-semibold ${n?"text-white":"text-gray-900"}`,children:m===h.TECHNICIAN?"My Assigned Tickets":"Repair Tickets"})}),t.jsx("div",{className:"border-b border-gray-200",children:t.jsxs("nav",{className:"-mb-px flex space-x-8",children:[t.jsx("button",{onClick:()=>de("create"),className:`py-2 px-1 border-b-2 font-medium text-sm ${K==="create"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Create Ticket"}),t.jsx("button",{onClick:()=>de("all"),className:`py-2 px-1 border-b-2 font-medium text-sm ${K==="all"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"All Tickets"})]})}),b&&t.jsx("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6 text-center`,children:t.jsx("p",{className:n?"text-white":"text-gray-900",children:"Loading tickets..."})}),u&&t.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[t.jsx("strong",{className:"font-bold",children:"Error!"}),t.jsxs("span",{className:"block sm:inline",children:[" ",u]})]}),K==="create"&&t.jsx(t.Fragment,{children:m===h.SUPER_ADMIN&&t.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[t.jsx("h2",{className:`text-lg font-semibold mb-4 ${n?"text-white":"text-gray-900"}`,children:l?"Edit Ticket":"Create New Ticket"}),!l&&!Y&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Client"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:G,onChange:e=>{L(e.target.value),C(""),te(!0)},onFocus:()=>te(!0),placeholder:"Search for a client...",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),t.jsx("button",{type:"button",onClick:()=>Z(!0),className:"mt-1 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"New Client"})]}),qe&&!k&&!Y&&Ne.length>0&&t.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:Ne.map(e=>t.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{C(e.id),L(e.name),te(!1)},children:[t.jsx("div",{className:"font-medium",children:e.name}),t.jsx("div",{className:"text-sm text-gray-500",children:e.email})]},e.id))})]})]}),Y?t.jsx(mt,{onSubmit:Qe,onCancel:()=>Z(!1)}):t.jsxs("form",{onSubmit:Ke,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Device Type"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:S,onChange:e=>{D(!0),B(e.target.value),_(!0)},onFocus:()=>_(!0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Search or add new device type",required:!0,onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),Ue&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[c.getState().settings.deviceTypes.filter(e=>e.toLowerCase().includes(S.toLowerCase())).map(e=>t.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{B(e),_(!1)},children:e},e)),S&&!c.getState().settings.deviceTypes.some(e=>e.toLowerCase()===S.toLowerCase())&&t.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{await Xe(S),_(!1)},children:['Add "',S,'"']})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Brand"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:x,onChange:e=>{D(!0),O(e.target.value),M(!0),e.target.value||P("")},onFocus:()=>M(!0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Search or add new brand",required:!0,onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),Re&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[c.getState().settings.brands.filter(e=>e.toLowerCase().includes(x.toLowerCase())).map(e=>t.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{O(e),P(""),M(!1)},children:e},e)),x&&!c.getState().settings.brands.some(e=>e.toLowerCase()===x.toLowerCase())&&t.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{const{addBrand:e}=c.getState();try{await e(x),P("")}catch(s){console.error("Error adding brand:",s)}M(!1)},children:['Add "',x,'"']})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Model"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:T,onChange:e=>{D(!0),P(e.target.value),U(!0)},onFocus:()=>U(!0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Search or add new model",required:!0,disabled:!x,onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),Be&&x&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[c.getState().settings.models.filter(e=>e.brandId===x&&e.name.toLowerCase().includes(T.toLowerCase())).map(e=>t.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{P(e.name),U(!1)},children:e.name},e.id)),T&&!c.getState().settings.models.some(e=>e.brandId===x&&e.name.toLowerCase()===T.toLowerCase())&&t.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{await et(T,x),U(!1)},children:['Add "',T,'"']})]})]})]}),m===h.SUPER_ADMIN&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Assign to Technician"}),t.jsxs("select",{value:pe,onChange:e=>ne(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"",children:"Unassigned"}),ue.map(e=>t.jsx("option",{value:e.id,children:e.fullName},e.id))]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Tasks"}),t.jsxs("div",{className:`text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:["Total Cost: €",ve.toFixed(2)]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:A,onChange:e=>{oe(e.target.value),R(!0)},onFocus:()=>R(!0),placeholder:"Search or add new task",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),Oe&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[c.getState().settings.tasks.filter(e=>e.toLowerCase().includes(A.toLowerCase())).slice(0,5).map(e=>t.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{ke(e),oe(""),R(!1)},children:e},e)),A&&!c.getState().settings.tasks.some(e=>e.toLowerCase()===A.toLowerCase())&&t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{const e=A,s=fe;I(i=>[...i,{name:e,price:s}]);const{addTask:r}=c.getState();try{await r(e)}catch(i){console.error("Error adding task:",i)}oe(""),be(0),R(!1)},children:['Add "',A,'"']}),t.jsxs("div",{className:"px-4 py-2 flex items-center",children:[t.jsx("span",{className:"mr-2",children:"Price:"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"mr-1",children:"€"}),t.jsx("input",{type:"number",value:fe,onChange:e=>be(Number(e.target.value)),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onClick:e=>e.stopPropagation()})]})]})]})]})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("h4",{className:`text-sm font-medium mb-2 ${n?"text-gray-300":"text-gray-700"}`,children:"Popular Tasks"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Array.from(c.getState().tickets.flatMap(e=>e.tasks).reduce((e,s)=>(e.set(s,(e.get(s)||0)+1),e),new Map).entries()).sort((e,s)=>s[1]-e[1]).slice(0,6).map(([e])=>t.jsxs("label",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",checked:p.some(s=>s.name===e),onChange:()=>{D(!0),p.some(r=>r.name===e)?I(r=>r.filter(i=>i.name!==e)):ke(e)},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),t.jsx("span",{className:n?"text-gray-300":"text-gray-700",children:e})]},e))})]}),p.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("h4",{className:`text-sm font-medium mb-2 ${n?"text-gray-300":"text-gray-700"}`,children:"Selected Tasks"}),t.jsx("div",{className:"space-y-2 border rounded-md p-3",children:p.map(e=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("button",{type:"button",onClick:()=>Je(e.name),className:"mr-2 text-red-500 hover:text-red-700",children:"Remove"}),t.jsx("span",{className:n?"text-gray-300":"text-gray-700",children:e.name})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"mr-1",children:"€"}),t.jsx("input",{type:"number",value:e.price,onChange:s=>We(e.name,Number(s.target.value)),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]})]},e.name))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Passcode (Optional)"}),t.jsx("input",{type:"text",value:ge,onChange:e=>ae(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Issue Description (Optional)"}),t.jsx("textarea",{value:xe,onChange:e=>se(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),l&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Status"}),t.jsxs("select",{value:he,onChange:e=>re(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"in-progress",children:"In Progress"}),t.jsx("option",{value:"completed",children:"Completed"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Payment Status"}),t.jsxs("select",{value:ie,onChange:e=>q(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"not_paid",children:"Not Paid"}),t.jsx("option",{value:"partially_paid",children:"Partially Paid"}),t.jsx("option",{value:"fully_paid",children:"Fully Paid"})]})]}),ie==="partially_paid"&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Amount Paid (€)"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:ye,onChange:e=>z(parseFloat(e.target.value)||0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"0.00"})]}),t.jsxs("div",{className:"flex justify-end gap-4",children:[t.jsx("button",{type:"button",onClick:()=>{ce(!1),V(null),L(""),C(""),D(!1)},className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:b,children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",disabled:b,children:b?l?"Updating...":"Creating...":l?"Update Ticket":"Create Ticket"})]})]})]})}),K==="all"&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[t.jsxs("div",{className:"flex-1 space-y-4 sm:space-y-0 sm:flex sm:items-center sm:gap-4",children:[t.jsxs("select",{value:H,onChange:e=>He(e.target.value),className:"w-full sm:w-40 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"all",children:"Search All"}),t.jsx("option",{value:"ticket",children:"Ticket Number"}),t.jsx("option",{value:"client",children:"Client Info"}),t.jsx("option",{value:"tasks",children:"Tasks"})]}),t.jsxs("div",{className:"flex-1 flex items-center gap-4 bg-white dark:bg-gray-700 p-4 rounded-lg shadow-inner",children:[t.jsx(at,{className:"h-5 w-5 text-gray-400"}),t.jsx("input",{type:"text",placeholder:`Search ${H==="all"?"tickets":H}...`,value:ee,onChange:e=>_e(e.target.value),className:"flex-1 bg-transparent border-0 focus:ring-0 text-gray-900 dark:text-white placeholder-gray-400"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("select",{value:w,onChange:e=>Q(e.target.value),className:"rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"in-progress",children:"In Progress"}),t.jsx("option",{value:"completed",children:"Completed"})]}),t.jsxs("button",{onClick:()=>ze(e=>e==="asc"?"desc":"asc"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",title:"Sort by date",children:[t.jsx(Ae,{className:"h-4 w-4"}),t.jsx(rt,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:we==="asc"?"Oldest First":"Newest First"})]})]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsx("thead",{className:n?"bg-gray-700":"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Ticket #"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Device"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Tasks"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Cost"}),m===h.SUPER_ADMIN&&t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Technician"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider min-w-[120px] w-[180px] sm:w-[160px] md:w-[180px]",children:"Payment"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider min-w-[120px]",children:"Date"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:`divide-y divide-gray-200 dark:divide-gray-700 ${n?"bg-gray-800":"bg-white"}`,children:je.length>0?je.map(e=>{const s=o.find(i=>i.id===e.clientId),r=e.taskPrices?e.taskPrices.map(i=>`${i.name} (€${i.price})`).join(", "):e.tasks.join(", ");return t.jsxs("tr",{className:`hover:${n?"bg-gray-700":"bg-gray-50"}`,children:[t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:["#",e.ticketNumber]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(nt,{className:"h-4 w-4 mr-2 text-gray-400"}),(s==null?void 0:s.name)||"Unknown Client"]})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:[e.deviceType," - ",e.brand]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300 max-w-xs truncate",children:r}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["€",e.cost]}),m===h.SUPER_ADMIN&&t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:e.technicianId?Ge(e.technicianId):"Unassigned"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:le(e)?t.jsxs("select",{value:e.status,onChange:i=>f(e.id,{status:i.target.value}),className:"text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"in-progress",children:"In Progress"}),t.jsx("option",{value:"completed",children:"Completed"})]}):Ye(e.status)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:le(e)?t.jsxs("select",{value:e.paymentStatus||"not_paid",onChange:i=>{const j=i.target.value;f(e.id,{paymentStatus:j,amountPaid:j==="not_paid"?0:e.amountPaid||0})},className:"text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"not_paid",children:"Not Paid"}),t.jsx("option",{value:"partially_paid",children:"Partially Paid"}),t.jsx("option",{value:"fully_paid",children:"Fully Paid"})]}):Ze(e.paymentStatus||"not_paid")}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ae,{className:"h-4 w-4 mr-2 text-gray-400"}),e.createdAt?ct(new Date(e.createdAt),"MMM d, yyyy"):"Unknown"]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:t.jsxs("div",{className:"flex justify-center space-x-3",children:[le(e)&&t.jsx("button",{onClick:()=>{V(e.id),de("create")},className:"text-blue-600 hover:text-blue-800",title:"Edit",children:t.jsx(it,{className:"h-5 w-5"})}),t.jsx("button",{onClick:()=>{$(e.ticketNumber),C(e.clientId),X(!0)},className:"text-green-600 hover:text-green-800",title:"Print Receipt",children:t.jsx(ot,{className:"h-5 w-5"})}),t.jsx("button",{onClick:()=>{$(e.ticketNumber),C(e.clientId),me(!0)},className:"text-indigo-600 hover:text-indigo-800",title:"Generate Invoice",children:t.jsx(dt,{className:"h-5 w-5"})}),m===h.SUPER_ADMIN&&t.jsx("button",{onClick:()=>Ve(e.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:t.jsx(lt,{className:"h-5 w-5"})})]})})]},e.id)}):t.jsx("tr",{children:t.jsx("td",{colSpan:m===h.SUPER_ADMIN?9:8,className:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:m===h.TECHNICIAN?"No tickets assigned to you yet":"No tickets found"})})})]})})]})}),Fe&&F&&t.jsx(Ie,{data:De(v.find(e=>e.ticketNumber===F),k,o.find(e=>e.id===k)),onClose:()=>{X(!1),$("")},initialFormat:"thermal"}),$e&&F&&t.jsx(Ie,{data:De(v.find(e=>e.ticketNumber===F),k,o.find(e=>e.id===k)),onClose:()=>me(!1),initialFormat:"a4"})]})}export{jt as default};
