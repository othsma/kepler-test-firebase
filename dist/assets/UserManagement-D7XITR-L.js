import{j as e}from"./vendor-pdf-renderer-B-tj8P8O.js";import{r as n}from"./vendor-react-DSd34EeT.js";import{u as M,d as T,R as l,n as f,s as S,r as L}from"./index-Bl_N4zjX.js";import{l as k,m as A,e as P,d as H}from"./vendor-firebase-_xt56fuP.js";import{Y as _,E as q,n as z,r as Q,h as V,X as G}from"./vendor-ui-QjxOl2QA.js";import"./vendor-utils-Bnff-AKO.js";import"./vendor-pdf-utils-CBrSDip1.js";function W(){const t=M(s=>s.isDarkMode),{userRole:g}=T(),[U,p]=n.useState([]),[$,N]=n.useState(!0),[j,d]=n.useState(""),[w,x]=n.useState(""),[y,E]=n.useState(""),[I,h]=n.useState(!1),[a,o]=n.useState({fullName:"",email:"",password:"",phoneNumber:"",role:l.TECHNICIAN}),[b,v]=n.useState(!1);n.useEffect(()=>{(async()=>{if(g!==l.SUPER_ADMIN){d("Vous n'avez pas la permission d'accéder à cette page"),N(!1);return}try{const r=k(f,"users"),m=(await A(r)).docs.map(c=>({id:c.id,...c.data()}));p(m)}catch(r){console.error("Error fetching users:",r),d("Échec du chargement des utilisateurs")}finally{N(!1)}})()},[g]);const D=async(s,r)=>{try{d(""),x("");const i=await P(H(f,"users",s));if(i.exists()&&i.data().email==="othsma@gmail.com"){d("Impossible de changer le rôle du super administrateur");return}const m=await S(s,r);m.success?(p(c=>c.map(u=>u.id===s?{...u,role:r}:u)),x("Rôle de l'utilisateur mis à jour avec succès")):d(m.error||"Échec de la mise à jour du rôle utilisateur")}catch(i){d(i.message||"Une erreur inattendue s'est produite")}},R=async s=>{s.preventDefault(),v(!0),d(""),x("");try{const r=await L(a.email,a.password,a.fullName,a.phoneNumber);if(r.success){a.role!==l.TECHNICIAN&&r.user&&await S(r.user.uid,a.role);const i=k(f,"users"),c=(await A(i)).docs.map(u=>({id:u.id,...u.data()}));p(c),x("Utilisateur créé avec succès"),h(!1),o({fullName:"",email:"",password:"",phoneNumber:"",role:l.TECHNICIAN})}else d(r.error||"Échec de la création de l'utilisateur")}catch(r){d(r.message||"Une erreur inattendue s'est produite")}finally{v(!1)}},C=U.filter(s=>{var r,i;return((r=s.fullName)==null?void 0:r.toLowerCase().includes(y.toLowerCase()))||((i=s.email)==null?void 0:i.toLowerCase().includes(y.toLowerCase()))});return g!==l.SUPER_ADMIN?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:`text-xl font-semibold mb-2 ${t?"text-white":"text-gray-900"}`,children:"Accès refusé"}),e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:"Vous n'avez pas la permission d'accéder à cette page."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:`text-2xl font-semibold ${t?"text-white":"text-gray-900"}`,children:"Gestion des utilisateurs"}),j&&e.jsxs("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded flex items-center",children:[e.jsx(_,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:j})]}),w&&e.jsxs("div",{className:"p-3 bg-green-100 border border-green-400 text-green-700 rounded flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:w})]}),e.jsxs("div",{className:`rounded-lg ${t?"bg-gray-800":"bg-white"} shadow p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3  flex items-center pointer-events-none",children:e.jsx(z,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Rechercher des utilisateurs...",value:y,onChange:s=>E(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"ml-4 flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:[e.jsx(Q,{className:"h-4 w-4"}),"Ajouter un utilisateur"]})]}),$?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"}),e.jsx("p",{className:`mt-4 ${t?"text-gray-300":"text-gray-600"}`,children:"Chargement des utilisateurs..."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:t?"bg-gray-700":"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Nom"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Téléphone"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Rôle"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y divide-gray-200 dark:divide-gray-700 ${t?"bg-gray-800":"bg-white"}`,children:C.length>0?C.map(s=>e.jsxs("tr",{className:`hover:${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx(V,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:`font-medium ${t?"text-white":"text-gray-900"}`,children:s.fullName}),e.jsxs("div",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["ID utilisateur: ",s.id.substring(0,8),"..."]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:t?"text-gray-300":"text-gray-500",children:s.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:t?"text-gray-300":"text-gray-500",children:s.phoneNumber||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.role===l.SUPER_ADMIN?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"}`,children:s.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.email==="othsma@gmail.com"?e.jsx("span",{className:"text-sm text-gray-500",children:"Super Admin (verrouillé)"}):e.jsxs("select",{value:s.role,onChange:r=>D(s.id,r.target.value),className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e.jsx("option",{value:l.TECHNICIAN,children:"Technicien"}),e.jsx("option",{value:l.SUPER_ADMIN,children:"Super Admin"})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:"Aucun utilisateur trouvé"})})})]})})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:`text-lg font-medium ${t?"text-white":"text-gray-900"}`,children:"Ajouter un nouvel utilisateur"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-1`,children:["Nom complet ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.fullName,onChange:s=>o({...a,fullName:s.target.value}),className:`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white"}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-1`,children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",value:a.email,onChange:s=>o({...a,email:s.target.value}),className:`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white"}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-1`,children:["Mot de passe ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",value:a.password,onChange:s=>o({...a,password:s.target.value}),className:`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white"}`,required:!0,minLength:6})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-1`,children:"Téléphone"}),e.jsx("input",{type:"tel",value:a.phoneNumber,onChange:s=>o({...a,phoneNumber:s.target.value}),className:`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white"}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-1`,children:["Rôle ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.role,onChange:s=>o({...a,role:s.target.value}),className:`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white"}`,required:!0,children:[e.jsx("option",{value:l.TECHNICIAN,children:"Technicien"}),e.jsx("option",{value:l.SUPER_ADMIN,children:"Super Admin"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Annuler"}),e.jsxs("button",{type:"submit",disabled:b,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2",children:[b&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"}),b?"Création...":"Créer l'utilisateur"]})]})]})]})})})]})}export{W as default};
