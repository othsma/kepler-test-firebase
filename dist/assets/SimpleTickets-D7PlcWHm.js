import{j as t}from"./vendor-pdf-renderer-BDu2W1LG.js";import{r}from"./vendor-react-DSd34EeT.js";import{u as Fe,b as Ue,g as it,a as u,d as ot,R as y,U as Me,f as dt,h as lt,i as ct}from"./index-DsS16Tuc.js";import{n as mt,p as _e,J as ut,h as gt,K as xt,F as ht,T as pt}from"./vendor-ui-QjxOl2QA.js";import{f as yt}from"./vendor-utils-Bnff-AKO.js";import"./vendor-firebase-gzZOYVNO.js";import"./vendor-pdf-utils-CBrSDip1.js";function ft({onSubmit:n,onCancel:A}){const g=Fe(i=>i.isDarkMode),{addClient:ie,loading:N}=Ue(),[h,v]=r.useState({name:"",email:"",phone:"",address:""}),[q,w]=r.useState("");r.useEffect(()=>{w(it())},[]);const k=async i=>{i.preventDefault();const l={...h,customerCode:q},$=await ie(l);$?n($):console.error("Failed to create client")};return t.jsxs("form",{onSubmit:k,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${g?"text-gray-300":"text-gray-700"}`,children:"Name"}),t.jsx("input",{type:"text",value:h.name,onChange:i=>v({...h,name:i.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${g?"text-gray-300":"text-gray-700"}`,children:"Email (Optional)"}),t.jsx("input",{type:"email",value:h.email,onChange:i=>v({...h,email:i.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${g?"text-gray-300":"text-gray-700"}`,children:"Phone"}),t.jsx("input",{type:"tel",value:h.phone,onChange:i=>v({...h,phone:i.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${g?"text-gray-300":"text-gray-700"}`,children:"Address (Optional)"}),t.jsx("textarea",{value:h.address,onChange:i=>v({...h,address:i.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),t.jsx("div",{className:`p-4 rounded-lg ${g?"bg-indigo-900 border border-indigo-700":"bg-indigo-50 border border-indigo-200"}`,children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:`p-2 rounded-full ${g?"bg-indigo-800":"bg-indigo-100"}`,children:t.jsx("svg",{className:`h-5 w-5 ${g?"text-indigo-400":"text-indigo-600"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h4",{className:`text-sm font-medium ${g?"text-indigo-200":"text-indigo-800"}`,children:"Code d'accÃ¨s client"}),t.jsx("p",{className:`text-lg font-mono font-bold ${g?"text-indigo-100":"text-indigo-900"}`,children:q}),t.jsx("p",{className:`text-xs mt-1 ${g?"text-indigo-300":"text-indigo-600"}`,children:"Donnez ce code au client pour qu'il puisse accÃ©der Ã  ses rÃ©parations"})]})]})}),t.jsxs("div",{className:"flex justify-end gap-4",children:[t.jsx("button",{type:"button",onClick:A,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:N,children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",disabled:N,children:N?"Creating...":"Create Client"})]})]})}function It(){const n=Fe(e=>e.isDarkMode),{tickets:A,updateTicket:g,deleteTicket:ie,loading:N,error:h,filterStatus:v,setFilterStatus:q}=u(),{clients:w}=Ue(),{user:k,userRole:i}=ot(),l=r.useRef(!sessionStorage.getItem("ticketSessionActive"));l.current&&(sessionStorage.clear(),sessionStorage.setItem("ticketSessionActive","true"));const[$,T]=r.useState(()=>{try{return JSON.parse(sessionStorage.getItem("ticketFormStarted")||"false")}catch{return!1}}),[bt,ye]=r.useState(!1),[c,oe]=r.useState(null),[L,M]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketClientSearch")||""}catch{return""}return""}),[D,E]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketSelectedClientId")||""}catch{return""}return""}),[Be,de]=r.useState(!1),[Re,fe]=r.useState(!1),[le,be]=r.useState(null),[we,je]=r.useState(""),[ce,me]=r.useState(!1),[ue,ze]=r.useState(""),[Ne,qe]=r.useState([]),[He,H]=r.useState(!1),[Oe,O]=r.useState(!1),[Je,J]=r.useState(!1),[We,W]=r.useState(!1),[Ke,ge]=r.useState(!1),[f,_]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketDeviceType")||""}catch{return""}return""}),[m,F]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketBrand")||""}catch{return""}return""}),[j,S]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketModel")||""}catch{return""}return""}),[x,C]=r.useState(()=>{if(!l.current)try{const e=sessionStorage.getItem("ticketTasksWithPrice");return e?JSON.parse(e):[]}catch{return[]}return[]}),[K,G]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketIssue")||""}catch{return""}return""}),[Q,V]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketPasscode")||""}catch{return""}return""}),[X,xe]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketImeiSerial")||""}catch{return""}return""}),[Y,Z]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketStatus")||"pending"}catch{return"pending"}return"pending"}),[ee,te]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketTechnicianId")||""}catch{return""}return""}),[U,B]=r.useState(()=>{if(!l.current)try{return sessionStorage.getItem("ticketPaymentStatus")||"not_paid"}catch{return"not_paid"}return"not_paid"}),[se,R]=r.useState(()=>{if(!l.current)try{return parseFloat(sessionStorage.getItem("ticketAmountPaid")||"0")}catch{return 0}return 0}),[P,he]=r.useState(""),[ve,ke]=r.useState(0),[Se,Ge]=r.useState("desc"),[re,Qe]=r.useState("all"),[ae,pe]=r.useState("all");r.useEffect(()=>{(async()=>{try{if(i===y.SUPER_ADMIN){const s=await ct();qe(s||[])}}catch(s){console.error("Error fetching technicians:",s)}})()},[i]),r.useEffect(()=>{if(c){const e=A.find(s=>s.id===c);e&&(_(e.deviceType||""),F(e.brand||""),S(e.model||""),G(e.issue||""),V(e.passcode||""),xe(e.imeiSerial||""),R(e.amountPaid||0),C(e.taskPrices||e.tasks.map(s=>({name:s,price:e.cost/(e.tasks.length||1)}))),Z(e.status||"pending"),te(e.technicianId||""),B(e.paymentStatus||"not_paid"))}},[c]),r.useEffect(()=>{try{sessionStorage.setItem("ticketFormStarted",JSON.stringify($)),sessionStorage.setItem("ticketClientSearch",L),sessionStorage.setItem("ticketSelectedClientId",D),sessionStorage.setItem("ticketDeviceType",f),sessionStorage.setItem("ticketBrand",m),sessionStorage.setItem("ticketModel",j),sessionStorage.setItem("ticketTasksWithPrice",JSON.stringify(x)),sessionStorage.setItem("ticketIssue",K),sessionStorage.setItem("ticketPasscode",Q),sessionStorage.setItem("ticketImeiSerial",X),sessionStorage.setItem("ticketStatus",Y),sessionStorage.setItem("ticketTechnicianId",ee),sessionStorage.setItem("ticketPaymentStatus",U),sessionStorage.setItem("ticketAmountPaid",se.toString())}catch(e){console.error("Error saving form state to sessionStorage:",e)}},[$,L,D,f,m,j,x,K,Q,Y,ee,U,se]);const Ce=A.filter(e=>{var s,a,o,b,I,ne,Pe,Ae,Le,$e;if(i===y.TECHNICIAN&&k&&e.technicianId!==k.uid||v!=="all"&&e.status!==v)return!1;if(ue){const d=w.find(z=>z.id===e.clientId),p=ue.toLowerCase();switch(re){case"tasks":return e.tasks.some(z=>z.toLowerCase().includes(p));case"client":return((s=d==null?void 0:d.name)==null?void 0:s.toLowerCase().includes(p))||((a=d==null?void 0:d.email)==null?void 0:a.toLowerCase().includes(p))||((o=d==null?void 0:d.phone)==null?void 0:o.toLowerCase().includes(p));case"ticket":return(b=e.ticketNumber)==null?void 0:b.toLowerCase().includes(p);case"all":default:return((I=e.ticketNumber)==null?void 0:I.toLowerCase().includes(p))||((ne=e.deviceType)==null?void 0:ne.toLowerCase().includes(p))||((Pe=e.brand)==null?void 0:Pe.toLowerCase().includes(p))||((Ae=d==null?void 0:d.name)==null?void 0:Ae.toLowerCase().includes(p))||((Le=d==null?void 0:d.email)==null?void 0:Le.toLowerCase().includes(p))||(($e=d==null?void 0:d.phone)==null?void 0:$e.toLowerCase().includes(p))||e.tasks.some(z=>z.toLowerCase().includes(p))}}return!0}).sort((e,s)=>{const a=new Date(e.createdAt).getTime(),o=new Date(s.createdAt).getTime();return Se==="asc"?a-o:o-a}),Ie=w.filter(e=>{var s,a;return((s=e.name)==null?void 0:s.toLowerCase().includes(L.toLowerCase()))||((a=e.email)==null?void 0:a.toLowerCase().includes(L.toLowerCase()))}),Te=x.reduce((e,s)=>e+(s.price||0),0),Ve=async e=>{var s;e.preventDefault();try{if(!D&&!c){alert("Please select a client");return}const a=x.map(I=>I.name),o=c?((s=A.find(I=>I.id===c))==null?void 0:s.clientId)||"":D;if(!o){alert("Client ID is required");return}const b={deviceType:f,brand:m,model:j,tasks:a,taskPrices:x,issue:K,passcode:Q,imeiSerial:X,status:Y,cost:Te,technicianId:ee||"",clientId:o,paymentStatus:U,amountPaid:se};if(console.log("Creating ticket with IMEI data:",{imeiSerial:X,ticketData:b}),c)await g(c,b),oe(null);else{const{addTicket:I}=u.getState(),ne=await I(b);je(ne),de(!0)}c||(ye(!1),M(""),E(""),_(""),F(""),S(""),C([]),G(""),V(""),xe(""),Z("pending"),te(""),B("not_paid"),R(0),T(!1)),c||(B("not_paid"),R(0))}catch(a){console.error("Error submitting ticket:",a),alert("An error occurred while saving the ticket. Please try again.")}},De=e=>{e.trim()&&C([...x,{name:e.trim(),price:0}])},Xe=e=>{C(x.filter(s=>s.name!==e))},Ye=(e,s)=>{C(x.map(a=>a.name===e?{...a,price:s}:a))},Ze=e=>{const s=w.find(a=>a.id===e);s&&(E(e),M(s.name)),me(!1)},et=async e=>{if(window.confirm("Are you sure you want to delete this ticket?"))try{await ie(e)}catch(s){console.error("Error deleting ticket:",s),alert("An error occurred while deleting the ticket.")}},tt=e=>{const s=Ne.find(a=>a.id===e);return s?s.fullName:"Unassigned"},st=async e=>{const{addDeviceType:s}=u.getState();await s(e)},Ee=e=>!!(i===y.SUPER_ADMIN||i===y.TECHNICIAN&&k&&e.technicianId===(k==null?void 0:k.uid)),rt=e=>{switch(e){case"pending":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:"En attente"});case"in-progress":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:"En cours"});case"completed":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"TerminÃ©"});default:return null}},at=e=>{switch(e){case"not_paid":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"Non payÃ©"});case"partially_paid":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:"Partiellement payÃ©"});case"fully_paid":return t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"PayÃ©"});default:return null}},nt=async(e,s)=>{const{addModel:a}=u.getState();await a({name:e,brandId:s})};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex justify-between items-center",children:t.jsx("h1",{className:`text-2xl font-semibold ${n?"text-white":"text-gray-900"}`,children:i===y.TECHNICIAN?"Mes tickets assignÃ©s":"Tickets de rÃ©paration"})}),t.jsx("div",{className:"border-b border-gray-200",children:t.jsxs("nav",{className:"-mb-px flex space-x-8",children:[t.jsx("button",{onClick:()=>pe("create"),className:`py-2 px-1 border-b-2 font-medium text-sm ${ae==="create"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"CrÃ©er un ticket"}),t.jsx("button",{onClick:()=>pe("all"),className:`py-2 px-1 border-b-2 font-medium text-sm ${ae==="all"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Tous les tickets"})]})}),N&&t.jsx("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6 text-center`,children:t.jsx("p",{className:n?"text-white":"text-gray-900",children:"Chargement des tickets..."})}),h&&t.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[t.jsx("strong",{className:"font-bold",children:"Error!"}),t.jsxs("span",{className:"block sm:inline",children:[" ",h]})]}),ae==="create"&&t.jsx(t.Fragment,{children:i===y.SUPER_ADMIN&&t.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[t.jsx("h2",{className:`text-lg font-semibold mb-4 ${n?"text-white":"text-gray-900"}`,children:c?"Modifier le ticket":"CrÃ©er un nouveau ticket"}),!c&&!ce&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Client"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:L,onChange:e=>{M(e.target.value),E(""),ge(e.target.value.length>0)},onBlur:()=>{setTimeout(()=>ge(!1),200)},placeholder:"Commencez Ã  taper pour rechercher un client...",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),t.jsx("button",{type:"button",onClick:()=>me(!0),className:"mt-1 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Nouveau client"})]}),Ke&&L&&!D&&!ce&&Ie.length>0&&t.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:Ie.map(e=>t.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{E(e.id),M(e.name),ge(!1)},children:[t.jsx("div",{className:"font-medium",children:e.name}),t.jsx("div",{className:"text-sm text-gray-500",children:e.email})]},e.id))})]})]}),ce?t.jsx(ft,{onSubmit:Ze,onCancel:()=>me(!1)}):t.jsxs("form",{onSubmit:Ve,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Type d'appareil"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:f,onChange:e=>{T(!0),_(e.target.value),H(e.target.value.length>0)},onBlur:()=>{setTimeout(()=>H(!1),200)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Commencez Ã  taper pour rechercher un type d'appareil",required:!0,onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),He&&f&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[u.getState().settings.deviceTypes.filter(e=>e.toLowerCase().includes(f.toLowerCase())).map(e=>t.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{_(e),H(!1)},children:e},e)),f&&!u.getState().settings.deviceTypes.some(e=>e.toLowerCase()===f.toLowerCase())&&t.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{await st(f),H(!1)},children:['Add "',f,'"']})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Marque"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:m,onChange:e=>{T(!0),F(e.target.value),O(e.target.value.length>0),e.target.value||S("")},onBlur:()=>{setTimeout(()=>O(!1),200)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Commencez Ã  taper pour rechercher une marque",required:!0,onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),Oe&&m&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[u.getState().settings.brands.filter(e=>e.toLowerCase().includes(m.toLowerCase())).map(e=>t.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{F(e),S(""),O(!1)},children:e},e)),m&&!u.getState().settings.brands.some(e=>e.toLowerCase()===m.toLowerCase())&&t.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{const{addBrand:e}=u.getState();try{await e(m),S("")}catch(s){console.error("Error adding brand:",s)}O(!1)},children:['Add "',m,'"']})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"ModÃ¨le"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:j,onChange:e=>{T(!0),S(e.target.value),J(e.target.value.length>0)},onBlur:()=>{setTimeout(()=>J(!1),200)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Commencez Ã  taper pour rechercher un modÃ¨le",required:!0,disabled:!m,onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),Je&&m&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[u.getState().settings.models.filter(e=>e.brandId===m&&e.name.toLowerCase().includes(j.toLowerCase())).map(e=>t.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{S(e.name),J(!1)},children:e.name},e.id)),j&&!u.getState().settings.models.some(e=>e.brandId===m&&e.name.toLowerCase()===j.toLowerCase())&&t.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{await nt(j,m),J(!1)},children:['Add "',j,'"']})]})]})]}),i===y.SUPER_ADMIN&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Assigner Ã  un technicien"}),t.jsxs("select",{value:ee,onChange:e=>te(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"",children:"Non assignÃ©"}),Ne.map(e=>t.jsx("option",{value:e.id,children:e.fullName},e.id))]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"TÃ¢ches"}),t.jsxs("div",{className:`text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:["CoÃ»t total: â‚¬",Te.toFixed(2)]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:P,onChange:e=>{he(e.target.value),W(e.target.value.length>0)},onBlur:()=>{setTimeout(()=>W(!1),200)},placeholder:"Commencez Ã  taper pour rechercher une tÃ¢che",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),We&&P&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[u.getState().settings.tasks.filter(e=>e.toLowerCase().includes(P.toLowerCase())).slice(0,5).map(e=>t.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{De(e),he(""),W(!1)},children:e},e)),P&&!u.getState().settings.tasks.some(e=>e.toLowerCase()===P.toLowerCase())&&t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{const e=P,s=ve,a=[...x,{name:e,price:s}];sessionStorage.setItem("ticketTasksWithPrice",JSON.stringify(a)),C(a),T(!0);const{addTask:o}=u.getState();try{await o(e)}catch(b){console.error("Error adding task:",b)}he(""),ke(0),W(!1)},children:['Add "',P,'"']}),t.jsxs("div",{className:"px-4 py-2 flex items-center",children:[t.jsx("span",{className:"mr-2",children:"Price:"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"mr-1",children:"â‚¬"}),t.jsx("input",{type:"number",value:ve,onChange:e=>ke(Number(e.target.value)),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onClick:e=>e.stopPropagation()})]})]})]})]})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("h4",{className:`text-sm font-medium mb-2 ${n?"text-gray-300":"text-gray-700"}`,children:"TÃ¢ches populaires"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Array.from(u.getState().tickets.flatMap(e=>e.tasks).reduce((e,s)=>(e.set(s,(e.get(s)||0)+1),e),new Map).entries()).sort((e,s)=>s[1]-e[1]).slice(0,6).map(([e])=>t.jsxs("label",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",checked:x.some(s=>s.name===e),onChange:()=>{T(!0),x.some(a=>a.name===e)?C(a=>a.filter(o=>o.name!==e)):De(e)},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),t.jsx("span",{className:n?"text-gray-300":"text-gray-700",children:e})]},e))})]}),x.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("h4",{className:`text-sm font-medium mb-2 ${n?"text-gray-300":"text-gray-700"}`,children:"TÃ¢ches sÃ©lectionnÃ©es"}),t.jsx("div",{className:"space-y-2 border rounded-md p-3",children:x.map(e=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("button",{type:"button",onClick:()=>Xe(e.name),className:"mr-2 text-red-500 hover:text-red-700",children:"Supprimer"}),t.jsx("span",{className:n?"text-gray-300":"text-gray-700",children:e.name})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"mr-1",children:"â‚¬"}),t.jsx("input",{type:"number",value:e.price,onChange:s=>Ye(e.name,Number(s.target.value)),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]})]},e.name))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Code de dÃ©verrouillage (optionnel)"}),t.jsx("input",{type:"text",value:Q,onChange:e=>V(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"IMEI / NumÃ©ro de SÃ©rie (optionnel)"}),t.jsx("input",{type:"text",value:X,onChange:e=>xe(e.target.value),placeholder:"Entrez l'IMEI ou le numÃ©ro de sÃ©rie",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Description du problÃ¨me (optionnel)"}),t.jsx("textarea",{value:K,onChange:e=>G(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),c&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Statut"}),t.jsxs("select",{value:Y,onChange:e=>Z(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"pending",children:"En attente"}),t.jsx("option",{value:"in-progress",children:"En cours"}),t.jsx("option",{value:"completed",children:"TerminÃ©"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Statut du paiement"}),t.jsxs("select",{value:U,onChange:e=>B(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"not_paid",children:"Non payÃ©"}),t.jsx("option",{value:"partially_paid",children:"Partiellement payÃ©"}),t.jsx("option",{value:"fully_paid",children:"PayÃ©"})]})]}),U==="partially_paid"&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Montant payÃ© (â‚¬)"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:se,onChange:e=>R(parseFloat(e.target.value)||0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"0.00"})]}),t.jsxs("div",{className:"flex justify-end gap-4",children:[t.jsx("button",{type:"button",onClick:()=>{ye(!1),oe(null),M(""),E(""),_(""),F(""),S(""),C([]),G(""),V(""),Z("pending"),te(""),B("not_paid"),R(0),T(!1)},className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:N,children:"Annuler"}),t.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",disabled:N,children:N?c?"Mise Ã  jour...":"CrÃ©ation...":c?"Mettre Ã  jour le ticket":"CrÃ©er le ticket"})]})]})]})}),ae==="all"&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[t.jsxs("div",{className:"flex-1 space-y-4 sm:space-y-0 sm:flex sm:items-center sm:gap-4",children:[t.jsxs("select",{value:re,onChange:e=>Qe(e.target.value),className:"w-full sm:w-40 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"all",children:"Tout rechercher"}),t.jsx("option",{value:"ticket",children:"NumÃ©ro de ticket"}),t.jsx("option",{value:"client",children:"Informations client"}),t.jsx("option",{value:"tasks",children:"TÃ¢ches"})]}),t.jsxs("div",{className:"flex-1 flex items-center gap-4 bg-white dark:bg-gray-700 p-4 rounded-lg shadow-inner",children:[t.jsx(mt,{className:"h-5 w-5 text-gray-400"}),t.jsx("input",{type:"text",placeholder:`Rechercher des ${re==="all"?"tickets":re}...`,value:ue,onChange:e=>ze(e.target.value),className:"flex-1 bg-transparent border-0 focus:ring-0 text-gray-900 dark:text-white placeholder-gray-400"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("select",{value:v,onChange:e=>q(e.target.value),className:"rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"all",children:"Tous les statuts"}),t.jsx("option",{value:"pending",children:"En attente"}),t.jsx("option",{value:"in-progress",children:"En cours"}),t.jsx("option",{value:"completed",children:"TerminÃ©"})]}),t.jsxs("button",{onClick:()=>Ge(e=>e==="asc"?"desc":"asc"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",title:"Trier par date",children:[t.jsx(_e,{className:"h-4 w-4"}),t.jsx(ut,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:Se==="asc"?"Plus ancien d'abord":"Plus rÃ©cent d'abord"})]})]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsx("thead",{className:n?"bg-gray-700":"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Ticket #"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Appareil"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"TÃ¢ches"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"CoÃ»t"}),i===y.SUPER_ADMIN&&t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Technicien"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider min-w-[120px] w-[180px] sm:w-[160px] md:w-[180px]",children:"Paiement"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider min-w-[120px]",children:"Date"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:`divide-y divide-gray-200 dark:divide-gray-700 ${n?"bg-gray-800":"bg-white"}`,children:Ce.length>0?Ce.map(e=>{const s=w.find(o=>o.id===e.clientId),a=e.taskPrices?e.taskPrices.map(o=>`${o.name} (â‚¬${o.price})`).join(", "):e.tasks.join(", ");return t.jsxs("tr",{className:`hover:${n?"bg-gray-700":"bg-gray-50"}`,children:[t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:["#",e.ticketNumber]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(gt,{className:"h-4 w-4 mr-2 text-gray-400"}),(s==null?void 0:s.name)||"Unknown Client"]})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:[e.deviceType," - ",e.brand]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300 max-w-xs truncate",children:a}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["â‚¬",e.cost]}),i===y.SUPER_ADMIN&&t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:e.technicianId?tt(e.technicianId):"Unassigned"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:Ee(e)?t.jsxs("select",{value:e.status,onChange:o=>g(e.id,{status:o.target.value}),className:"text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[t.jsx("option",{value:"pending",children:"En attente"}),t.jsx("option",{value:"in-progress",children:"En cours"}),t.jsx("option",{value:"completed",children:"TerminÃ©"})]}):rt(e.status)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:at(e.paymentStatus||"not_paid")}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(_e,{className:"h-4 w-4 mr-2 text-gray-400"}),e.createdAt?yt(new Date(e.createdAt),"MMM d, yyyy"):"Unknown"]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:t.jsxs("div",{className:"flex justify-center space-x-3",children:[Ee(e)&&t.jsx("button",{onClick:()=>{oe(e.id),pe("create")},className:"text-blue-600 hover:text-blue-800",title:"Edit",children:t.jsx(xt,{className:"h-5 w-5"})}),t.jsx("button",{onClick:()=>{je(e.ticketNumber),E(e.clientId),de(!0)},className:"text-indigo-600 hover:text-indigo-800",title:"Generate Document",children:t.jsx(ht,{className:"h-5 w-5"})}),t.jsx("button",{onClick:()=>{if(!w.find(b=>b.id===e.clientId)){alert("Client information not found for this ticket.");return}be(e),E(e.clientId),fe(!0)},className:"text-purple-600 hover:text-purple-800",title:"Generate Engagement Contract",children:"ðŸ“„"}),i===y.SUPER_ADMIN&&t.jsx("button",{onClick:()=>et(e.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:t.jsx(pt,{className:"h-5 w-5"})})]})})]},e.id)}):t.jsx("tr",{children:t.jsx("td",{colSpan:i===y.SUPER_ADMIN?9:8,className:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:i===y.TECHNICIAN?"No tickets assigned to you yet":"No tickets found"})})})]})})]})}),Be&&we&&t.jsx(Me,{data:dt(A.find(e=>e.ticketNumber===we),D,w.find(e=>e.id===D)),onClose:()=>de(!1),initialFormat:"a4"}),Re&&le&&t.jsx(Me,{data:lt(le,w.find(e=>e.id===le.clientId)),onClose:()=>{fe(!1),be(null)},initialFormat:"a4"})]})}export{It as default};
