import{j as e}from"./vendor-pdf-renderer-B-tj8P8O.js";import{r as x}from"./vendor-react-DSd34EeT.js";import{t as w,u as $}from"./index-Bl_N4zjX.js";import{p as f}from"./pushManager-Lb2bV3Ik.js";import{B as S,a6 as P,X as b,Y as y,z as N,W as j,E as v,j as C}from"./vendor-ui-QjxOl2QA.js";import"./vendor-firebase-_xt56fuP.js";import"./vendor-utils-Bnff-AKO.js";import"./vendor-pdf-utils-CBrSDip1.js";function E(){const[t,a]=x.useState(!1),[i,m]=x.useState(!1),[c,p]=x.useState(!1),{profile:r,fetchProfile:h}=w(),n=$(l=>l.isDarkMode);x.useEffect(()=>{a((()=>{var o,d;return console.log("PushNotificationBanner: Checking visibility...",{isPushSupported:f.isPushSupported,hasProfile:!!r,profileId:r==null?void 0:r.id,pushEnabled:(o=r==null?void 0:r.notificationPreferences)==null?void 0:o.pushEnabled,permission:Notification.permission}),f.isPushSupported?r!=null&&r.id?(d=r.notificationPreferences)!=null&&d.pushEnabled?(console.log("PushNotificationBanner: Already enabled"),!1):Notification.permission==="denied"?(console.log("PushNotificationBanner: Permission denied"),!1):(console.log("PushNotificationBanner: Should show banner"),!0):(console.log("PushNotificationBanner: No profile"),!1):(console.log("PushNotificationBanner: Not supported"),!1)})())},[r]);const g=async()=>{if(r!=null&&r.id){m(!0);try{await f.subscribeToPush(r.id)&&(p(!0),await h(),setTimeout(()=>{a(!1)},3e3))}catch(l){console.error("Failed to subscribe to push notifications:",l)}finally{m(!1)}}},u=()=>{a(!1)};return t?e.jsx("div",{className:`rounded-lg shadow-lg border-l-4 border-indigo-500 p-4 mb-6 ${n?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(S,{className:"h-6 w-6 text-indigo-500"})}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium ${n?"text-white":"text-gray-900"}`,children:c?"Notifications activ√©es !":"Recevoir des notifications"}),e.jsx("div",{className:"mt-2",children:c?e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-4 w-4 text-green-500 mr-2"}),e.jsx("p",{className:`text-sm ${n?"text-gray-300":"text-gray-600"}`,children:"Vous recevrez d√©sormais des notifications sur l'√©tat de vos r√©parations."})]}):e.jsx("p",{className:`text-sm ${n?"text-gray-300":"text-gray-600"}`,children:"Soyez inform√© en temps r√©el de l'avancement de vos r√©parations. Recevez des notifications push sur votre t√©l√©phone ou ordinateur."})})]}),e.jsx("div",{className:"flex-shrink-0 ml-4",children:c?e.jsx("button",{onClick:u,className:`inline-flex items-center px-2 py-1.5 border border-transparent text-xs font-medium rounded-md ${n?"text-gray-400 hover:text-gray-300 hover:bg-gray-700":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:e.jsx(b,{className:"h-4 w-4"})}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:g,disabled:i,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-white mr-1"}),"Activation..."]}):"Activer"}),e.jsx("button",{onClick:u,className:`inline-flex items-center px-2 py-1.5 border border-transparent text-xs font-medium rounded-md ${n?"text-gray-400 hover:text-gray-300 hover:bg-gray-700":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:e.jsx(b,{className:"h-4 w-4"})})]})})]})})]})}):null}function I(){var o,d;const t=$(s=>s.isDarkMode),{profile:a,tickets:i,loading:m,error:c,fetchProfile:p,fetchTickets:r,subscribeToTickets:h}=w();if(x.useEffect(()=>{if(a)return r(),h()},[a,r,h]),m)return e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Chargement..."})]});if(c)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(y,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Erreur de chargement"}),e.jsx("p",{className:"text-gray-500",children:c})]});const n=s=>{switch(s){case"pending":return e.jsx(N,{className:"h-5 w-5 text-yellow-500"});case"in-progress":return e.jsx(j,{className:"h-5 w-5 text-blue-500"});case"completed":return e.jsx(v,{className:"h-5 w-5 text-green-500"});default:return e.jsx(y,{className:"h-5 w-5 text-gray-500"})}},g=s=>{switch(s){case"pending":return"En attente";case"in-progress":return"En cours";case"completed":return"Termin√©e";default:return s}},u=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"in-progress":return"bg-blue-100 text-blue-800 border-blue-200";case"completed":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},l=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-indigo-700 rounded-lg shadow-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"h-12 w-12 rounded-full bg-white bg-opacity-20 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-semibold",children:((o=a==null?void 0:a.fullName)==null?void 0:o.charAt(0).toUpperCase())||"?"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Bonjour, ",((d=a==null?void 0:a.fullName)==null?void 0:d.split(" ")[0])||"Client"]}),e.jsx("p",{className:"text-indigo-100 mt-1",children:"Voici l'√©tat de vos r√©parations"})]})]})}),e.jsx(E,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:`rounded-lg shadow p-6 ${t?"bg-gray-800":"bg-white"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(N,{className:"h-8 w-8 text-yellow-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:`text-sm font-medium ${t?"text-gray-400":"text-gray-500"}`,children:"En attente"}),e.jsx("p",{className:`text-2xl font-semibold ${t?"text-white":"text-gray-900"}`,children:i.filter(s=>s.status==="pending").length})]})]})}),e.jsx("div",{className:`rounded-lg shadow p-6 ${t?"bg-gray-800":"bg-white"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(j,{className:"h-8 w-8 text-blue-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:`text-sm font-medium ${t?"text-gray-400":"text-gray-500"}`,children:"En cours"}),e.jsx("p",{className:`text-2xl font-semibold ${t?"text-white":"text-gray-900"}`,children:i.filter(s=>s.status==="in-progress").length})]})]})}),e.jsx("div",{className:`rounded-lg shadow p-6 ${t?"bg-gray-800":"bg-white"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(v,{className:"h-8 w-8 text-green-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:`text-sm font-medium ${t?"text-gray-400":"text-gray-500"}`,children:"Termin√©es"}),e.jsx("p",{className:`text-2xl font-semibold ${t?"text-white":"text-gray-900"}`,children:i.filter(s=>s.status==="completed").length})]})]})})]}),e.jsxs("div",{className:`rounded-lg shadow ${t?"bg-gray-800":"bg-white"}`,children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:`text-lg font-semibold ${t?"text-white":"text-gray-900"}`,children:"Mes R√©parations"}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"} mt-1`,children:"Suivez l'√©volution de vos appareils"})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:i.length===0?e.jsxs("div",{className:"px-6 py-12 text-center",children:[e.jsx(C,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:`text-lg font-medium ${t?"text-white":"text-gray-900"} mb-2`,children:"Aucune r√©paration"}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"Vous n'avez pas encore de r√©paration en cours."})]}):i.map(s=>e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:n(s.status)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsxs("h3",{className:`text-sm font-medium ${t?"text-white":"text-gray-900"}`,children:[s.deviceType," ",s.brand," ",s.model]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${u(s.status)}`,children:g(s.status)})]}),s.issue&&e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"} mb-2`,children:s.issue}),e.jsxs("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"} space-y-1`,children:[e.jsxs("p",{children:["R√©paration #",s.ticketNumber]}),e.jsxs("p",{children:["Derni√®re mise √† jour: ",l(s.updatedAt)]}),s.estimatedCompletion&&e.jsxs("p",{children:["Estimation: ",l(s.estimatedCompletion)]})]})]})]}),e.jsxs("div",{className:`text-right ${t?"text-white":"text-gray-900"}`,children:[e.jsxs("p",{className:"text-lg font-semibold",children:[s.cost,"‚Ç¨"]}),s.paymentStatus&&e.jsx("p",{className:`text-xs ${s.paymentStatus==="fully_paid"?"text-green-600":s.paymentStatus==="partially_paid"?"text-yellow-600":"text-red-600"}`,children:s.paymentStatus==="fully_paid"?"Pay√©":s.paymentStatus==="partially_paid"?"Partiellement pay√©":"Non pay√©"})]})]})},s.id))})]}),e.jsx("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"} text-center`,children:"üîÑ Mises √† jour en temps r√©el activ√©es"})]})}export{I as default};
