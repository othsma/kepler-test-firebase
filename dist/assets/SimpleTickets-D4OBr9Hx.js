import{j as s}from"./vendor-pdf-renderer-Bq4DoPCL.js";import{r}from"./vendor-react-NkhADs9z.js";import{u as Se,b as Te,a as m,d as Ge,R as x,g as Je}from"./index-BurnjtrH.js";import{U as ve,c as ke}from"./DocumentConverter-Cv4_NsDK.js";import{n as Ve,o as Xe,p as Ce,A as Ye,h as Ze,t as es,u as ss,F as ts,s as as}from"./vendor-ui-DgdEuPZ6.js";import{f as rs}from"./vendor-utils-BK9ZHHVQ.js";import"./vendor-firebase-CWMDWzYz.js";import"./vendor-pdf-utils-BfYXEYrK.js";function ns({onSubmit:n,onCancel:b}){const k=Se(d=>d.isDarkMode),{addClient:W,loading:w}=Te(),[u,N]=r.useState({name:"",email:"",phone:"",address:""}),G=async d=>{d.preventDefault();const g=await W(u);g?n(g):console.error("Failed to create client")};return s.jsxs("form",{onSubmit:G,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${k?"text-gray-300":"text-gray-700"}`,children:"Name"}),s.jsx("input",{type:"text",value:u.name,onChange:d=>N({...u,name:d.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${k?"text-gray-300":"text-gray-700"}`,children:"Email (Optional)"}),s.jsx("input",{type:"email",value:u.email,onChange:d=>N({...u,email:d.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${k?"text-gray-300":"text-gray-700"}`,children:"Phone"}),s.jsx("input",{type:"tel",value:u.phone,onChange:d=>N({...u,phone:d.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${k?"text-gray-300":"text-gray-700"}`,children:"Address (Optional)"}),s.jsx("textarea",{value:u.address,onChange:d=>N({...u,address:d.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:w,children:"Cancel"}),s.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",disabled:w,children:w?"Creating...":"Create Client"})]})]})}function gs(){const n=Se(e=>e.isDarkMode),{tickets:b,updateTicket:k,deleteTicket:W,loading:w,error:u,filterStatus:N,setFilterStatus:G}=m(),{clients:d}=Te(),{user:g,userRole:l}=Ge(),[J,V]=r.useState(!1),[c,X]=r.useState(null),[Y,L]=r.useState(""),[C,S]=r.useState(""),[De,Z]=r.useState(!1),[Ie,ne]=r.useState(!1),[M,U]=r.useState(""),[ee,se]=r.useState(!1),[te,Ae]=r.useState(""),[ie,Pe]=r.useState([]),[Le,F]=r.useState(!1),[Ee,R]=r.useState(!1),[$e,_]=r.useState(!1),[Me,q]=r.useState(!1),[Ue,ae]=r.useState(!1),[T,I]=r.useState(""),[h,A]=r.useState(""),[D,f]=r.useState(""),[y,j]=r.useState([]),[de,B]=r.useState(""),[oe,H]=r.useState(""),[le,O]=r.useState("pending"),[ce,z]=r.useState(""),[P,re]=r.useState(""),[me,xe]=r.useState(0),[ue,Fe]=r.useState("desc"),[K,Re]=r.useState("all");r.useEffect(()=>{(async()=>{try{if(l===x.SUPER_ADMIN){const t=await Je();Pe(t||[])}}catch(t){console.error("Error fetching technicians:",t)}})()},[l]),r.useEffect(()=>{if(c){const e=b.find(t=>t.id===c);e&&(I(e.deviceType||""),A(e.brand||""),f(e.model||""),j(e.taskPrices||e.tasks.map(t=>({name:t,price:e.cost/(e.tasks.length||1)}))),B(e.issue||""),H(e.passcode||""),O(e.status||"pending"),z(e.technicianId||""))}else I(""),A(""),f(""),j([]),B(""),H(""),O("pending"),z(l===x.TECHNICIAN&&g?g.uid:"")},[c,b,l,g]);const ge=b.filter(e=>{var t,a,i,E,v,Q,be,we,Ne,je;if(l===x.TECHNICIAN&&g&&e.technicianId!==g.uid||N!=="all"&&e.status!==N)return!1;if(te){const o=d.find($=>$.id===e.clientId),p=te.toLowerCase();switch(K){case"tasks":return e.tasks.some($=>$.toLowerCase().includes(p));case"client":return((t=o==null?void 0:o.name)==null?void 0:t.toLowerCase().includes(p))||((a=o==null?void 0:o.email)==null?void 0:a.toLowerCase().includes(p))||((i=o==null?void 0:o.phone)==null?void 0:i.toLowerCase().includes(p));case"ticket":return(E=e.ticketNumber)==null?void 0:E.toLowerCase().includes(p);case"all":default:return((v=e.ticketNumber)==null?void 0:v.toLowerCase().includes(p))||((Q=e.deviceType)==null?void 0:Q.toLowerCase().includes(p))||((be=e.brand)==null?void 0:be.toLowerCase().includes(p))||((we=o==null?void 0:o.name)==null?void 0:we.toLowerCase().includes(p))||((Ne=o==null?void 0:o.email)==null?void 0:Ne.toLowerCase().includes(p))||((je=o==null?void 0:o.phone)==null?void 0:je.toLowerCase().includes(p))||e.tasks.some($=>$.toLowerCase().includes(p))}}return!0}).sort((e,t)=>{const a=new Date(e.createdAt).getTime(),i=new Date(t.createdAt).getTime();return ue==="asc"?a-i:i-a}),he=d.filter(e=>{var t,a;return((t=e.name)==null?void 0:t.toLowerCase().includes(Y.toLowerCase()))||((a=e.email)==null?void 0:a.toLowerCase().includes(Y.toLowerCase()))}),pe=y.reduce((e,t)=>e+(t.price||0),0),_e=async e=>{var t;e.preventDefault();try{if(!C&&!c){alert("Please select a client");return}const a=y.map(v=>v.name),i=c?((t=b.find(v=>v.id===c))==null?void 0:t.clientId)||"":C;if(!i){alert("Client ID is required");return}const E={deviceType:T,brand:h,model:D,tasks:a,taskPrices:y,issue:de,passcode:oe,status:le,cost:pe,technicianId:ce||"",clientId:i};if(c)await k(c,E),X(null);else{const{addTicket:v}=m.getState(),Q=await v(E);U(Q),Z(!0)}c||(V(!1),L(""),S(""),I(""),A(""),f(""),j([]),B(""),H(""),O("pending"),z(""))}catch(a){console.error("Error submitting ticket:",a),alert("An error occurred while saving the ticket. Please try again.")}},ye=e=>{e.trim()&&j([...y,{name:e.trim(),price:0}])},qe=e=>{j(y.filter(t=>t.name!==e))},Be=(e,t)=>{j(y.map(a=>a.name===e?{...a,price:t}:a))},He=e=>{const t=d.find(a=>a.id===e);t&&(S(e),L(t.name)),se(!1)},Oe=async e=>{if(window.confirm("Are you sure you want to delete this ticket?"))try{await W(e)}catch(t){console.error("Error deleting ticket:",t),alert("An error occurred while deleting the ticket.")}},ze=e=>{const t=ie.find(a=>a.id===e);return t?t.fullName:"Unassigned"},Ke=async e=>{const{addDeviceType:t}=m.getState();await t(e),I(e),A(""),f("")},fe=e=>!!(l===x.SUPER_ADMIN||l===x.TECHNICIAN&&g&&e.technicianId===(g==null?void 0:g.uid)),Qe=e=>{switch(e){case"pending":return s.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:"Pending"});case"in-progress":return s.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:"In Progress"});case"completed":return s.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"Completed"});default:return null}},We=async(e,t)=>{const{addModel:a}=m.getState();await a({name:e,brandId:t}),f(e)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:`text-2xl font-semibold ${n?"text-white":"text-gray-900"}`,children:l===x.TECHNICIAN?"My Assigned Tickets":"Repair Tickets"}),l===x.SUPER_ADMIN&&s.jsxs("button",{onClick:()=>V(!J),className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 flex items-center gap-2",children:[s.jsx(Ve,{className:"h-4 w-4"}),J?"Hide Form":"New Ticket"]})]}),w&&s.jsx("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6 text-center`,children:s.jsx("p",{className:n?"text-white":"text-gray-900",children:"Loading tickets..."})}),u&&s.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[s.jsx("strong",{className:"font-bold",children:"Error!"}),s.jsxs("span",{className:"block sm:inline",children:[" ",u]})]}),(J||c)&&l===x.SUPER_ADMIN&&s.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[s.jsx("h2",{className:`text-lg font-semibold mb-4 ${n?"text-white":"text-gray-900"}`,children:c?"Edit Ticket":"Create New Ticket"}),!c&&!ee&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Client"}),s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:Y,onChange:e=>{L(e.target.value),S(""),ae(!0)},onFocus:()=>ae(!0),placeholder:"Search for a client...",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),s.jsx("button",{type:"button",onClick:()=>se(!0),className:"mt-1 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"New Client"})]}),Ue&&!C&&!ee&&he.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:he.map(e=>s.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{S(e.id),L(e.name),ae(!1)},children:[s.jsx("div",{className:"font-medium",children:e.name}),s.jsx("div",{className:"text-sm text-gray-500",children:e.email})]},e.id))})]})]}),ee?s.jsx(ns,{onSubmit:He,onCancel:()=>se(!1)}):s.jsxs("form",{onSubmit:_e,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Device Type"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:T,onChange:e=>{I(e.target.value),F(!0)},onFocus:()=>F(!0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Search or add new device type",required:!0,onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),Le&&s.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[m.getState().settings.deviceTypes.filter(e=>e.toLowerCase().includes(T.toLowerCase())).map(e=>s.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{I(e),F(!1)},children:e},e)),T&&!m.getState().settings.deviceTypes.some(e=>e.toLowerCase()===T.toLowerCase())&&s.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{await Ke(T),F(!1)},children:['Add "',T,'"']})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Brand"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:h,onChange:e=>{A(e.target.value),R(!0),e.target.value||f("")},onFocus:()=>R(!0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Search or add new brand",required:!0,onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),Ee&&s.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[m.getState().settings.brands.filter(e=>e.toLowerCase().includes(h.toLowerCase())).map(e=>s.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{f(""),A(e),R(!1)},children:e},e)),h&&!m.getState().settings.brands.some(e=>e.toLowerCase()===h.toLowerCase())&&s.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{const{addBrand:e}=m.getState();try{await e(h)}catch(t){console.error("Error adding brand:",t)}R(!1)},children:['Add "',h,'"']})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Model"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:D,onChange:e=>{f(e.target.value),_(!0)},onFocus:()=>_(!0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Search or add new model",required:!0,disabled:!h,onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),$e&&h&&s.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[m.getState().settings.models.filter(e=>e.brandId===h&&e.name.toLowerCase().includes(D.toLowerCase())).map(e=>s.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{f(e.name),_(!1)},children:e.name},e.id)),D&&!m.getState().settings.models.some(e=>e.brandId===h&&e.name.toLowerCase()===D.toLowerCase())&&s.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{await We(D,h),_(!1)},children:['Add "',D,'"']})]})]})]}),l===x.SUPER_ADMIN&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Assign to Technician"}),s.jsxs("select",{value:ce,onChange:e=>z(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[s.jsx("option",{value:"",children:"Unassigned"}),ie.map(e=>s.jsx("option",{value:e.id,children:e.fullName},e.id))]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Tasks"}),s.jsxs("div",{className:`text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:["Total Cost: $",pe.toFixed(2)]})]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:P,onChange:e=>{re(e.target.value),q(!0)},onFocus:()=>q(!0),placeholder:"Search or add new task",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onKeyDown:e=>{if(e.key==="Enter")return e.preventDefault(),!1}}),Me&&s.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-md shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5",children:[m.getState().settings.tasks.filter(e=>e.toLowerCase().includes(P.toLowerCase())).slice(0,5).map(e=>s.jsx("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-900",onClick:()=>{ye(e),re(""),q(!1)},children:e},e)),P&&!m.getState().settings.tasks.some(e=>e.toLowerCase()===P.toLowerCase())&&s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-indigo-600",onClick:async()=>{const e=P,t=me;j(i=>[...i,{name:e,price:t}]);const{addTask:a}=m.getState();try{await a(e)}catch(i){console.error("Error adding task:",i)}re(""),xe(0),q(!1)},children:['Add "',P,'"']}),s.jsxs("div",{className:"px-4 py-2 flex items-center",children:[s.jsx("span",{className:"mr-2",children:"Price:"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"mr-1",children:"$"}),s.jsx("input",{type:"number",value:me,onChange:e=>xe(Number(e.target.value)),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onClick:e=>e.stopPropagation()})]})]})]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("h4",{className:`text-sm font-medium mb-2 ${n?"text-gray-300":"text-gray-700"}`,children:"Popular Tasks"}),s.jsx("div",{className:"grid grid-cols-2 gap-2",children:Array.from(m.getState().tickets.flatMap(e=>e.tasks).reduce((e,t)=>(e.set(t,(e.get(t)||0)+1),e),new Map).entries()).sort((e,t)=>t[1]-e[1]).slice(0,6).map(([e])=>s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:y.some(t=>t.name===e),onChange:()=>{y.some(a=>a.name===e)?j(a=>a.filter(i=>i.name!==e)):ye(e)},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),s.jsx("span",{className:n?"text-gray-300":"text-gray-700",children:e})]},e))})]}),y.length>0&&s.jsxs("div",{className:"mt-4",children:[s.jsx("h4",{className:`text-sm font-medium mb-2 ${n?"text-gray-300":"text-gray-700"}`,children:"Selected Tasks"}),s.jsx("div",{className:"space-y-2 border rounded-md p-3",children:y.map(e=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{type:"button",onClick:()=>qe(e.name),className:"mr-2 text-red-500 hover:text-red-700",children:"Remove"}),s.jsx("span",{className:n?"text-gray-300":"text-gray-700",children:e.name})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"mr-1",children:"$"}),s.jsx("input",{type:"number",value:e.price,onChange:t=>Be(e.name,Number(t.target.value)),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]})]},e.name))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Passcode (Optional)"}),s.jsx("input",{type:"text",value:oe,onChange:e=>H(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Issue Description (Optional)"}),s.jsx("textarea",{value:de,onChange:e=>B(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),c&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-300":"text-gray-700"}`,children:"Status"}),s.jsxs("select",{value:le,onChange:e=>O(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[s.jsx("option",{value:"pending",children:"Pending"}),s.jsx("option",{value:"in-progress",children:"In Progress"}),s.jsx("option",{value:"completed",children:"Completed"})]})]}),s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx("button",{type:"button",onClick:()=>{V(!1),X(null),L(""),S("")},className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:w,children:"Cancel"}),s.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",disabled:w,children:w?c?"Updating...":"Creating...":c?"Update Ticket":"Create Ticket"})]})]})]}),s.jsxs("div",{className:`rounded-lg ${n?"bg-gray-800":"bg-white"} shadow p-6`,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[s.jsxs("div",{className:"flex-1 space-y-4 sm:space-y-0 sm:flex sm:items-center sm:gap-4",children:[s.jsxs("select",{value:K,onChange:e=>Re(e.target.value),className:"w-full sm:w-40 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[s.jsx("option",{value:"all",children:"Search All"}),s.jsx("option",{value:"ticket",children:"Ticket Number"}),s.jsx("option",{value:"client",children:"Client Info"}),s.jsx("option",{value:"tasks",children:"Tasks"})]}),s.jsxs("div",{className:"flex-1 flex items-center gap-4 bg-white dark:bg-gray-700 p-4 rounded-lg shadow-inner",children:[s.jsx(Xe,{className:"h-5 w-5 text-gray-400"}),s.jsx("input",{type:"text",placeholder:`Search ${K==="all"?"tickets":K}...`,value:te,onChange:e=>Ae(e.target.value),className:"flex-1 bg-transparent border-0 focus:ring-0 text-gray-900 dark:text-white placeholder-gray-400"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("select",{value:N,onChange:e=>G(e.target.value),className:"rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"pending",children:"Pending"}),s.jsx("option",{value:"in-progress",children:"In Progress"}),s.jsx("option",{value:"completed",children:"Completed"})]}),s.jsxs("button",{onClick:()=>Fe(e=>e==="asc"?"desc":"asc"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",title:"Sort by date",children:[s.jsx(Ce,{className:"h-4 w-4"}),s.jsx(Ye,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:ue==="asc"?"Oldest First":"Newest First"})]})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[s.jsx("thead",{className:n?"bg-gray-700":"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Ticket #"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Device"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Tasks"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Cost"}),l===x.SUPER_ADMIN&&s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Technician"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:`divide-y divide-gray-200 dark:divide-gray-700 ${n?"bg-gray-800":"bg-white"}`,children:ge.length>0?ge.map(e=>{const t=d.find(i=>i.id===e.clientId),a=e.taskPrices?e.taskPrices.map(i=>`${i.name} ($${i.price})`).join(", "):e.tasks.join(", ");return s.jsxs("tr",{className:`hover:${n?"bg-gray-700":"bg-gray-50"}`,children:[s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:["#",e.ticketNumber]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Ze,{className:"h-4 w-4 mr-2 text-gray-400"}),(t==null?void 0:t.name)||"Unknown Client"]})}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:[e.deviceType," - ",e.brand]}),s.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300 max-w-xs truncate",children:a}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["$",e.cost]}),l===x.SUPER_ADMIN&&s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:e.technicianId?ze(e.technicianId):"Unassigned"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:fe(e)?s.jsxs("select",{value:e.status,onChange:i=>k(e.id,{status:i.target.value}),className:"text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[s.jsx("option",{value:"pending",children:"Pending"}),s.jsx("option",{value:"in-progress",children:"In Progress"}),s.jsx("option",{value:"completed",children:"Completed"})]}):Qe(e.status)}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Ce,{className:"h-4 w-4 mr-2 text-gray-400"}),e.createdAt?rs(new Date(e.createdAt),"MMM d, yyyy"):"Unknown"]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:s.jsxs("div",{className:"flex justify-center space-x-3",children:[fe(e)&&s.jsx("button",{onClick:()=>X(e.id),className:"text-blue-600 hover:text-blue-800",title:"Edit",children:s.jsx(es,{className:"h-5 w-5"})}),s.jsx("button",{onClick:()=>{U(e.ticketNumber),S(e.clientId),Z(!0)},className:"text-green-600 hover:text-green-800",title:"Print Receipt",children:s.jsx(ss,{className:"h-5 w-5"})}),s.jsx("button",{onClick:()=>{U(e.ticketNumber),S(e.clientId),ne(!0)},className:"text-indigo-600 hover:text-indigo-800",title:"Generate Invoice",children:s.jsx(ts,{className:"h-5 w-5"})}),l===x.SUPER_ADMIN&&s.jsx("button",{onClick:()=>Oe(e.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:s.jsx(as,{className:"h-5 w-5"})})]})})]},e.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:l===x.SUPER_ADMIN?9:8,className:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:l===x.TECHNICIAN?"No tickets assigned to you yet":"No tickets found"})})})]})})]}),De&&M&&s.jsx(ve,{data:ke(b.find(e=>e.ticketNumber===M),C,d.find(e=>e.id===C)),onClose:()=>{Z(!1),U("")},initialFormat:"thermal"}),Ie&&M&&s.jsx(ve,{data:ke(b.find(e=>e.ticketNumber===M),C,d.find(e=>e.id===C)),onClose:()=>ne(!1),initialFormat:"a4"})]})}export{gs as default};
